/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 *  PhoneSetup.c
 *
 * Project:
 * --------
 *  MAUI
 *
 * Description:
 * ------------
 *  This file is intends for phone setup application
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/

/***************************************************************************** 
* Include
*****************************************************************************/
/*  Include: MMI header file */
#include "MMI_features.h"
#include "ProtocolEvents.h"
#include "IMERes.h"
#include "CommonScreens.h"
#include "SettingsGexdcl.h"
#include "settingGprots.h"
#include "SettingDefs.h"
#include "PhnsetProt.h"
#include "ATHandlerProt.h"      /* SendATSetGreeting() */
#include "MainMenuDef.h"        /* MAIN_MENU_TITLE_SETTINGS_ICON */
#include "settingprot.h"        /* PhoneSetup Prototype */
#include "CSP.h"        /* CSP_VALUE_ADDED_SERVICES_SERVICE_GROUP, CSP_Language */
#include "SettingProfile.h"     /* WARNING_TONE */
#include "MessagesExDcl.h"      /* GetChildMenuIDIndexByParentMenuID()  */
#include "ScheduledPowerOnOffGProt.h"
#include "PhoneSetup.h"
#include "PhoneSetupGprots.h"
#include "Conversions.h"
#include "UCMGprot.h"
#include "IdleAppProt.h"
#include "RestoreGprot.h"
#include "ProfilesAppGprot.h"
#include "SettingMenuService.h"

#include "Menucuigprot.h"

#include "mmi_rp_app_nitz_def.h"
#include "SSCStringHandle.h"    /* SSC_ENGLISH, ... defination */

#ifdef __MMI_SET_DEF_ENCODING_TYPE__
#include "SSCStringHandle.h"
#endif /* __MMI_SET_DEF_ENCODING_TYPE__ */

#if 0
/* under construction !*/
/* under construction !*/
#endif /* __MMI_AUTO_LANG_EN__ */ 

#ifndef __DISABLE_SHORTCUTS_MENU__
#include "ShortcutsGprots.h"
#endif 

#if defined(__MMI_FE_VECTOR_FONT_ON_FILE_SYSTEM__)
#include "FontManagerGProt.h"
#endif

#ifdef __MMI_GADGET_SUPPORT__
#include "WgtMgrAppGprot.h"
#endif /* __MMI_GADGET_SUPPORT__ */

#ifdef __MMI_PREFER_INPUT_METHOD__
#include "PreferedInputMethodProt.h"  
#endif 

#ifdef __MMI_THEMES_APPLICATION__
#include "MMIThemes.h"
#endif /* __MMI_THEMES_APPLICATION__ */

/*  Include: PS header file */
#ifdef MMI_ON_HARDWARE_P
#include "lcd_if.h"
#include "lcd_sw_inc.h"
#endif /* MMI_ON_HARDWARE_P */ 

#ifdef __MMI_NITZ__
#include "nitz.h"
#endif

#ifdef __NTPD_SUPPORT__
#include "NtpApp.h"
#include "mmi_rp_app_ntp_def.h"
#endif
#if 0
#ifdef __MMI_OP12_TOOLBAR__
/* under construction !*/
#endif /* __MMI_OP12_TOOLBAR__ */
#endif
#include "PhnsetGpio.h"
#include "Menucuigprot.h"
#include "FlightModeGProt.h"
#include "Inlinecuigprot.h"

#include "CphsSrvGprot.h"
#ifndef __DISABLE_SHORTCUTS_IMPL__
#include "mmi_rp_app_shortcuts_def.h"
#endif /* __DISABLE_SHORTCUTS_IMPL__ */
#include "mmi_rp_app_gpio_def.h"

#include "FontDcl.h" /* For MAX_LANGUAGES */

#ifdef __MMI_VUI_SHELL_MSG_VIEWER__
#include "vadp_shell_msg_viewer.h"  /* vadp_shell_mv_refresh_panel */
#endif
#ifdef __DM_LAWMO_SUPPORT__
#include "Dmuigprot.h"
#endif /* __DM_LAWMO_SUPPORT__ */

#include "mmi_rp_app_worldclock_def.h"

#include "DialerCuiGprot.h"

/* auto add by kw_check begin */
#include "MMIDataType.h"
#include "gui_data_types.h"
#include "GlobalResDef.h"
#include "mmi_rp_app_phonesetting_new_def.h"
#include "mmi_rp_app_mainmenu_def.h"
#include "wgui_categories_inputs.h"
#include "ImeGprot.h"
#include "FontRes.h"
#include "GlobalConstants.h"
#include "custom_mmi_default_value.h"
#include "mmi_rp_app_idle_def.h"
#include "IdleAppResDef.h"
#include "mmi_frm_nvram_gprot.h"
#include "string.h"
#include "kal_general_types.h"
#include "MMI_features_type.h"
#include "mmi_phnset_dispchar.h"
#include "SSCStringTable.h"
#include "SettingGenum.h"
#include "nvram_data_items.h"
/*#include "l4c_common_enum.h"*/
#include "ps_public_enum.h"
#include "ps_public_struct.h"
#include "MMI_common_app_trc.h"
#include "mmi_common_app_trc.h"
#include "DebugInitDef_Int.h"
#include "kal_trace.h"
#include "mmiapi_dm_struct.h"
#include "stack_msgs.h"
#include "mmi_frm_events_gprot.h"
#include "wgui_categories_util.h"
#include "mmi_frm_history_gprot.h"
#include "mmi_frm_scenario_gprot.h"
#include "CustDataRes.h"
#include "AlertScreen.h"
#include "mmi_frm_mem_gprot.h"
#include "kal_public_api.h"
#include "Unicodexdcl.h"
#include "CommonScreensResDef.h"
#include "mmi_frm_input_gprot.h"
#include "wgui.h"
#include "nvram_common_defs.h"
#include "device.h"
#include "mmi_msg_struct.h"
#include "mmi_frm_queue_gprot.h"
#include "app_ltlcom.h"
#include "mmi_cb_mgr_gprot.h"
#include "UcmSrvGprot.h"
#include "stack_config.h"
#include "wgui_categories_popup.h"
#include "custom_events_notify.h"
#include "mmi_rp_srv_spof_def.h"
#ifdef __MMI_TELEPHONY_SUPPORT__
#include "mmi_rp_srv_flight_mode_def.h"
#endif
/* auto add by kw_check end */
#if defined(__MMI_TOUCH_SCREEN__)
#include "ImeGprot.h"
#endif
#include "mmi_rp_srv_general_setting_def.h" // Encoding type NVRAM

#include "GeneralSettingSrvGprot.h"
#include "SoundEffect.h"
#ifdef __GENERAL_TTS__
#include "TTSSettingGprot.h"
#endif
#include "ShortcutsGProts.h"
#include "IdleGprot.h"
#include "WPSSProtos.h"
#include "ShortcutsProts.h"
#include "PhnsetWidgetMgrGprot.h"
#include "vapp_launcher_key_gprot.h"
#include "Lang_interface.h"
#ifdef MOTION_SENSOR_SUPPORT
#include "motionsensorgprot.h"
#include "mmi_rp_motion_sensor_def.h"/* motion res in motionsensor.res cmm test*/
#endif
#include "MMI_ap_dcm_config.h"

#ifdef __MMI_BLE_TIP_SUPPORT__
#include "TipAppGprot.h"
#endif

#if defined(__MMI_BTD_BOX_UI_STYLE__) || defined(__MMI_WEARABLE_DEVICE_SETTING__)
#include "wgui_categories_btbox.h"
#include "wgui_swatch_common_pen_handle.h"
#include "SwatchGprot.h"
#include "Swatch.h"
#include "alarmdef.h"
#include "gpiosrvgprot.h"
#include "mmi_rp_srv_gpio_def.h"
#ifdef __MMI_BT_NOTI_SRV__
#include "Mmi_rp_srv_bt_noti_def.h"
#include "BTNotiSrvGprot.h"
#endif
#ifdef __MMI_WEARABLE_DEVICE_SETTING__
#include "mmi_frm_events_gprot.h"
#include "btcmsrvgprot.h"
#include "idlegprot.h"
#ifdef __HOTKNOT_SUPPORT__
#include "alarmprot.h"
#include "hotknot.h"
#endif
//#ifdef __MMI_PHB_LAST_NAME_FIELD__
#include "PhbPbapSrvGprot.h"
//#endif

#include "Lang_interface.h"
#endif
#ifdef __MMI_WEARABLE_DEVICE_UI_ENHANCE__
#include "wgui_progress_bar.h"
#endif
#include "PhbSrvGprot.h"
//#include "DateTimeSrvGprot.h"
extern mmi_phnset_gpio_cntx_struct *g_phnset_gpio_cntx_p;

static void mmi_phnset_time_auto_sync_menu(void);
static void mmi_phnset_entry_time_format_menu(void);
#ifdef __MMI_BT_NOTI_SRV__
void mmi_phnset_language_auto_sync(void *data);
#endif
#ifdef __MMI_WEARABLE_DEVICE_SETTING__
#ifdef __HOTKNOT_SUPPORT__
void mmi_phnset_hotknot_init(void);
#endif
#endif

#ifdef __MMI_WEARABLE_DEVICE_ALARM__
extern MMI_BOOL send_sync_alarm_cmd_to_sp();
#endif
swatch_alm_cell_info swatch_dispaly_cell_info;

#define SCREEN_TIME_OUT_NUM 5
static U16 gScreenTimeoutList[SCREEN_TIME_OUT_NUM]=
{
	STR_SCREEN_TIME_OUT_STR5,
	STR_SCREEN_TIME_OUT_STR10,
	STR_SCREEN_TIME_OUT_STR15,
	STR_SCREEN_TIME_OUT_STR30,
	STR_SCREEN_TIME_OUT_STR60
};
static U16 gBrighnessList[SCREEN_TIME_OUT_NUM]=
{
	STR_BRIGHTNESS_1,
	STR_BRIGHTNESS_2,
	STR_BRIGHTNESS_3,
	STR_BRIGHTNESS_4,
	STR_BRIGHTNESS_5
};
static U16 gMainMenuStyleList[2]=
{
	STR_MAIN_MENU_STYLE_1APP,
	STR_MAIN_MENU_STYLE_4APPS
};

#define BT_NOTIFY_SYNC_LANGUAGE_CMD "EXCD"
#define BT_NOTIFY_SYNC_LANGUAGE_SENDER "language"
#define BT_NOTIFY_SYNC_LANGUAGE_RECEIVER "mtk_language"


#define GDI_COLOR_HBUTTON    gdi_act_color_from_rgb(255, 52, 149, 165)
#define GDI_COLOR_BOLDER    gdi_act_color_from_rgb(255, 20, 25, 25)
#define GDI_COLOR_NORMAL    gdi_act_color_from_rgb(255, 62, 64, 76)
#define GDI_COLOR_HIGHLIGHT    gdi_act_color_from_rgb(255, 54, 155, 165)

#endif
/***************************************************************************** 
* Define
*****************************************************************************/
#if 0
/* under construction !*/
#endif 

//#ifdef __MMI_TOUCH_SCREEN__
#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#if defined (__MMI_IME_V3__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
#endif /* __MMI_TOUCH_SCREEN__ */ 
/***************************************************************************** 
* Typedef
*****************************************************************************/

/***************************************************************************** 
* Local Variable
*****************************************************************************/
#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __MMI_AUTO_LANG_EN__ */ 

//#ifdef __MMI_TOUCH_SCREEN__
#if 0
/* under construction !*/
#if defined(__MMI_IME_FTE_ENHANCE__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#else
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
/* under construction !*/
#endif /* __MMI_TOUCH_SCREEN__ */ 


/* Inline CUI */
cui_inline_item_softkey_struct g_phnset_common_softkey_data = 
{
    {{0, 0},
    {STR_GLOBAL_BACK, 0},
    {0, IMG_GLOBAL_COMMON_CSK}}
};
/* Handwriting setting */
#if (0) //defined(__MMI_TOUCH_SCREEN__) && !defined(__MMI_NO_HANDWRITING__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#if defined (__MMI_IME_V3__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#if defined (__MMI_IME_V3__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#if defined (__MMI_IME_V3__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#if defined (__MMI_IME_V3__)
/* under construction !*/
/* under construction !*/
#endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
#if defined (__MMI_IME_V3__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#else
/* under construction !*/
#endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* defined(__MMI_TOUCH_SCREEN__) && !defined(__MMI_NO_HANDWRITING__) */


/***************************************************************************** 
* Global Variable
*****************************************************************************/
PHNSET_CNTX g_phnset_cntx;
PHNSET_CNTX *g_phnset_cntx_p = &g_phnset_cntx;
extern U8 g_dst;

/***************************************************************************** 
* External Variable
*****************************************************************************/
/* Lagnuage */
extern sLanguageDetails *gLanguageArray;
extern U16 gCurrLangIndex;
extern U8 *ItemType[8];
extern PU8 subMenuDataPtrs[MAX_SUB_MENUS];
extern U16 gMaxDeployedLangs;

//#ifdef __MMI_PREFER_INPUT_METHOD__
//extern U8 *inputMethodList[9];
//extern U16 currInputMethodIndex;
//#endif /* __MMI_PREFER_INPUT_METHOD__ */ 

//#if defined(__MMI_MIXED_LANG_SUPPORT__) || defined(__MMI_PREFER_WRITING_LANG__)
//extern ime_writing_lang_struct g_ime_writing_lang_array[MAX_WRITING_LANG];
//#endif /* defined(__MMI_MIXED_LANG_SUPPORT__) || defined(__MMI_PREFER_WRITING_LANG__) */ 

/***************************************************************************** 
* Global Function
*****************************************************************************/

/***************************************************************************** 
* External Function
*****************************************************************************/
#ifdef __MMI_AUDIO_PLAYER__	
void mmi_audply_encoding_type_change_callback(void);
#endif

#ifdef __MMI_MEDIA_PLAYER__	
void mmi_medply_encoding_type_change_callback(void);
#endif

/*****************************************************************************
* Local Function 
*****************************************************************************/
/* AT handler */
#ifndef __MMI_PHNSET_AT_DISABLE__
static void mmi_phnset_init_at_handler(void);
#endif

/* Menu CUI */
static mmi_ret mmi_phnset_menu_handler(mmi_event_struct *param);
static mmi_ret mmi_phnset_main_menu_handler(cui_menu_event_struct *param, MMI_ID parent_gid);
static mmi_ret mmi_phnset_main_menu_entry_handler(cui_menu_event_struct *param, MMI_ID parent_gid);
#ifndef __MMI_PHNSET_SLIM__    
static mmi_ret mmi_phnset_main_menu_highlight_handler(cui_menu_event_struct * param, MMI_ID parent_gid);
#endif
static mmi_ret mmi_phnset_main_menu_select_handler(cui_menu_event_struct *param, MMI_ID parent_gid);
static mmi_ret mmi_phnset_main_menu_close_handler(cui_menu_event_struct *param, MMI_ID parent_gid);

static void mmi_phnset_init_main_menu(void);
static void mmi_phnset_init_language_menu(void);
static mmi_ret mmi_phnset_language_menu_proc(mmi_event_struct *param);
static void mmi_phnset_set_language_menu_hint(MMI_ID menucui_id);

#ifdef __MMI_CHANGABLE_FONT__
static mmi_ret mmi_phnset_font_size_proc(mmi_event_struct *param);
static void mmi_phnset_init_font_size_list(void); 
static void mmi_phnset_set_font_size_hint(MMI_ID menucui_id);
#endif /* __MMI_CHANGABLE_FONT__ */



/* Definition is missing */
void PhnsetDefEncodingSelectHandler(U8 highlight_id);

/* Language */
#ifndef __MMI_PHNSET_AT_DISABLE__
#ifndef __SLIM_AT__
static void SendLangChange2AT(U8 code, int mod_id);
#endif /*__SLIM_AT__*/
static void ATSetLanguage(void *msg, int mod_id);
#endif
static void mmi_phnset_entry_set_language(MMI_ID parent_id);
static void PhnsetLangLSKHandler(void);
#if 0
/* under construction !*/
/* under construction !*/
#endif /* __MMI_AUTO_LANG_EN__ */

/* Encoding Type */
#ifdef __MMI_SET_DEF_ENCODING_TYPE__
static void EntryPhnsetDefEncoding(MMI_ID parent_gid);
static void mmi_phnset_init_encoding_menu(void);
static mmi_ret mmi_phnset_encoding_menu_proc(mmi_event_struct *param);
static void mmi_phnset_set_encoding_menu_hint(MMI_ID menucui_id);
#endif


/* UART */
#ifdef __GEMINI__
#ifndef __MMI_PHNSET_AT_DISABLE__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
#endif /* __GEMINI__ */

/* GPIO */
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTING_RODATA" , code = "DYNAMIC_CODE_SETTING_ROCODE"
#endif
/*****************************************************************************
 * FUNCTION
 *  InitPhoneSetupCntx
 * DESCRIPTION
 *  This function is to initialize phone setup context
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void InitPhoneSetupCntx(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    //S16 Err = 0;
#ifdef __MMI_WEARABLE_DEVICE_SETTING__
	U8 set = 0;
#endif
#ifdef __MMI_WEARABLE_DEVICE__
		S16 default_timezone = 0;
#endif

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Common */
    g_phnset_cntx_p->curHightlightItem = 0;
#ifndef __MMI_PHNSET_SLIM__    
    g_phnset_cntx_p->ScrAnchor = IDLE_SCREEN_ID;
#endif
    /* Set Time and Date */
    g_phnset_cntx_p->currentCity = 0;
    g_phnset_cntx_p->CurHomeCityStrID = 0;
    g_phnset_cntx_p->CurHomeCityStrPtr = 0;
    g_phnset_cntx_p->CurTimeFmt = 0;
    g_phnset_cntx_p->CurDateFmt = 0;
#ifndef __MMI_PHNSET_SLIM__    
    g_phnset_cntx_p->AM_PM_flag = NULL;
#endif
#ifdef __MMI_WEARABLE_DEVICE_SETTING__
	ReadValueSlim(NVRAM_PHNSET_TIME_AUTO_SYNC_SETTING, &set, DS_BYTE);
	if(set == SETTING_TIME_AUTO_SYNC_ON)
	{
		//srv_dt_set_time_sync_switch(MMI_TRUE);
	}
	else
	{
		//srv_dt_set_time_sync_switch(MMI_FALSE);
	}
#endif
	//ReadValue(CURRENT_CITY, &(g_phnset_cntx_p->currentCity), DS_BYTE, &Err);
	ReadValueSlim(CURRENT_CITY, &(g_phnset_cntx_p->currentCity), DS_BYTE);
    if (g_phnset_cntx_p->currentCity == 0xff)
    {
    #ifdef __MMI_WEARABLE_DEVICE__
		g_phnset_cntx_p->currentCity = 40;
		WriteValueSlim(NVRAM_TIMEZONE, &default_timezone, DS_SHORT);
	#else
        g_phnset_cntx_p->currentCity = 0;
	#endif
        //WriteValue(CURRENT_CITY, &g_phnset_cntx_p->currentCity, DS_BYTE, &Err);
		WriteValueSlim(CURRENT_CITY, &(g_phnset_cntx_p->currentCity), DS_BYTE);
    }

    //ReadValue(NVRAM_SETTING_DT_DST, &(g_phnset_cntx_p->currentDST), DS_BYTE, &Err);
	ReadValueSlim(NVRAM_SETTING_DT_DST, &(g_phnset_cntx_p->currentDST), DS_BYTE);
    if (g_phnset_cntx_p->currentDST == 0xff)
    {
        g_phnset_cntx_p->currentDST = 0;
        //WriteValue(NVRAM_SETTING_DT_DST, &g_phnset_cntx_p->currentDST, DS_BYTE, &Err);
		WriteValueSlim(NVRAM_SETTING_DT_DST, &g_phnset_cntx_p->currentDST, DS_BYTE);
        g_dst = g_phnset_cntx_p->currentDST;
    }

    memset(&(g_phnset_cntx_p->settime), 0, sizeof(PHNSET_DATETIME_STRUCT));
#ifndef __MMI_PHNSET_SLIM__    

    /* NITZ */
    g_phnset_cntx_p->NITZDirtyFlag = MMI_FALSE;
    g_phnset_cntx_p->curNITZStatus = 0;
#endif    

    /* Phone Setup */
#ifndef __MMI_PHNSET_SLIM__    
    g_phnset_cntx_p->ShowOwnNumDirtyFlag = MMI_FALSE;
    g_phnset_cntx_p->ShowDtDirtyFlag = MMI_FALSE;
#endif    
    g_phnset_cntx_p->curShowDtStatus = 0;
#ifdef __MMI_IDLE_SCREEN_OWNER_NUMBER__    
    g_phnset_cntx_p->curShowOwnNumStatus = mmi_phnset_show_owner_number_is_on(MMI_SIM1);
#ifdef __MMI_DUAL_SIM_MASTER__    
/* under construction !*/
#endif
#endif
#if 0
/* under construction !*/
#if defined(__MMI_OPERATOR_NAME_MENU__)
/* under construction !*/
#endif 
#endif

#if 0
#if defined(__MMI_CALENDAR_ON_IDLE_SCREEN__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
        #if (defined(__MMI_MAINLCD_240X400__) || defined(__MMI_MAINLCD_320X480__))
/* under construction !*/
	#else	
/* under construction !*/
	#endif
/* under construction !*/
#endif
#endif
#if defined(__MMI_DUAL_CLOCK__)
    //ReadValue(NVRAM_SET_DUALCLOCK_IDLESCREEN, &(g_phnset_cntx_p->curDualClockStatus), DS_BYTE, &Err);
	ReadValueSlim(NVRAM_SET_DUALCLOCK_IDLESCREEN, &(g_phnset_cntx_p->curDualClockStatus), DS_BYTE);
    //if (g_phnset_cntx_p->curDualClockStatus == 0xFF || Err != NVRAM_READ_SUCCESS)
	if (g_phnset_cntx_p->curDualClockStatus == 0xFF)
    {
        g_phnset_cntx_p->curDualClockStatus = 0;
    }
#ifndef __MMI_WC_TZ_SUPPORT__
    g_phnset_cntx_p->curDualClockStatus = 0;
#endif
#endif

#ifdef __MMI_MAINMENU_STYLE_CHANGE_EN__
    g_phnset_cntx_p->MenuStyle = 0;
#endif 
    
#ifdef __MMI_MOTION_DIAL__
    g_phnset_cntx_p->DialStyle = 0;
#endif /* __MMI_MOTION_DIAL__ */

#ifdef __MMI_SCREEN_SWITCH_EFFECT__
    g_phnset_cntx_p->curScrSwitchEffect = __MMI_SCREEN_SWITCH_EFFECT_SETTING__;
#endif /* __MMI_SCREEN_SWITCH_EFFECT__ */

#ifdef __MMI_DUAL_CLOCK__
    g_phnset_cntx_p->curHomeScreenStatus = 1;
#endif /* __MMI_DUAL_CLOCK__ */

    /* Language */
    g_phnset_cntx_p->ppLang = NULL;
#ifndef __MMI_PHNSET_SLIM__    
    g_phnset_cntx_p->UsrLangIdx = 0;
    g_phnset_cntx_p->LP = CBS0_LANG_UNSPECIFIED;
#endif    

    /* Wallpaper & Screen Saver */
#ifndef __MMI_PHNSET_SLIM__    
    g_phnset_cntx_p->storage_invalid = MMI_FALSE;
    g_phnset_cntx_p->WPSSPreviewScrFlag = 1;
#endif
#ifndef __SLIM_AT__
    g_phnset_cntx_p->curtWpID = 0;
#endif
#ifdef __MMI_SUB_WALLPAPER__
    g_phnset_cntx_p->curtSubWpID = 0;
#endif 
#ifndef __MMI_PHNSET_SLIM__    

    g_phnset_cntx_p->curSSStatus = 0;
    g_phnset_cntx_p->curSSWaitTime = 0;
    g_phnset_cntx_p->SSStatusInlineHilite = 0;
#endif    
    g_phnset_cntx_p->SSWaitStatusInlineHilite = 2;
    g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_WP;

    memset(g_phnset_cntx_p->SysWPSSList, 0, sizeof(g_phnset_cntx_p->SysWPSSList));
#ifndef __MMI_PHNSET_SLIM__    
    memset(g_phnset_cntx_p->DwnlWPSSList, 0, sizeof(g_phnset_cntx_p->DwnlWPSSList));
#endif
    /*init sound effect settings, this shall be done before set lang by nvram 
    since it might effect equalizer values*/
    InitSoundEffect();

    srv_setting_init_language();
#ifdef __MMI_SET_DEF_ENCODING_TYPE__
    if (srv_setting_get_encoding_type() == 0xFF)
    {
        if (mmi_lang_support(SSC_ENGLISH) >= 0)
        {
            mmi_chset_enum encoding_type = mmi_chset_get_english_default_chset();
            srv_setting_set_encoding_type(encoding_type);
        #ifdef __MMI_AUDIO_PLAYER__
            mmi_audply_encoding_type_change_callback();
        #endif

        #ifdef __MMI_MEDIA_PLAYER__
    	    mmi_medply_encoding_type_change_callback();
	    #endif
        }
        else
        {
            srv_setting_set_encoding_type_by_language();
        }
    }

    g_chset_text_encoding = srv_setting_get_encoding_type();

#endif /* __MMI_SET_DEF_ENCODING_TYPE__ */ 

#ifdef __MMI_SCREEN_SWITCH_EFFECT__
    //ReadValue(NVRAM_SET_SCREFFECT_STYLE, &(g_phnset_cntx_p->curScrSwitchEffect), DS_BYTE, &Err);
	ReadValueSlim(NVRAM_SET_SCREFFECT_STYLE, &(g_phnset_cntx_p->curScrSwitchEffect), DS_BYTE);
    if (g_phnset_cntx_p->curScrSwitchEffect == 0xFF)
    {
        g_phnset_cntx_p->curScrSwitchEffect = __MMI_SCREEN_SWITCH_EFFECT_SETTING__;
    }
#endif /* __MMI_SCREEN_SWITCH_EFFECT__ */

#ifdef __MMI_BT_BOX_TEST_DIALER_PAD_STYLE__ 
	ReadValue(NVRAM_DISPCHAR_BT_BOX_DIALER_TYPE, &(g_phnset_cntx_p->curBtBoxDialerType), DS_BYTE, &Err);
    if (g_phnset_cntx_p->curBtBoxDialerType == 0xFF)
    {
        g_phnset_cntx_p->curBtBoxDialerType = MMI_PHNSET_BT_BOX_TYPE1;
    }

    ReadValue(NVRAM_DISPCHAR_BT_BOX_PICKER_TYPE, &(g_phnset_cntx_p->curBtBoxPickerType), DS_BYTE, &Err);
    if (g_phnset_cntx_p->curBtBoxPickerType == 0xFF)
    {
        g_phnset_cntx_p->curBtBoxPickerType = MMI_PHNSET_BT_BOX_PICKER_TYPE1;
    }
#endif  //__MMI_BT_BOX_TEST_DIALER_PAD_STYLE__
#if 0
/* under construction !*/
#if defined(__MMI_OP11_HOMESCREEN_0301__) || defined(__MMI_OP11_HOMESCREEN_0302__) || defined(__MMI_OP11_HOMESCREEN__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* defined(__MMI_OP11_HOMESCREEN_0301__) || defined(__MMI_OP11_HOMESCREEN_0302__) */
#endif
#ifdef __MMI_MAINMENU_STYLE_CHANGE_EN__
    //ReadValue(NVRAM_SET_MAINMENU_STYLE, &(g_phnset_cntx_p->MenuStyle), DS_BYTE, &Err);
	ReadValueSlim(NVRAM_SET_MAINMENU_STYLE, &(g_phnset_cntx_p->MenuStyle), DS_BYTE);
    if (g_phnset_cntx_p->MenuStyle == 0xFF 
#ifndef __MMI_MOTION_MAINMENU__        
        || g_phnset_cntx_p->MenuStyle >= PHNSET_MAINMENU_STYLE_MAX
#endif /* __MMI_MOTION_MAINMENU__ */
        )
    {
        g_phnset_cntx_p->MenuStyle = 0;
    }
#endif /* __MMI_MAINMENU_STYLE_CHANGE_EN__ */ 

#ifdef __MMI_MOTION_DIAL__      
   // ReadValue(NVRAM_SET_DIAL_STYLE, &(g_phnset_cntx_p->DialStyle), DS_BYTE, &Err);
	ReadValueSlim(NVRAM_SET_DIAL_STYLE, &(g_phnset_cntx_p->DialStyle), DS_BYTE);
    //if (g_phnset_cntx_p->DialStyle == 0xFF || Err != NVRAM_READ_SUCCESS)
	if (g_phnset_cntx_p->DialStyle == 0xFF )
    {
        g_phnset_cntx_p->DialStyle = 0;
    }
#endif  /* __MMI_MOTION_DIAL__ */

#if (0) //defined(__MMI_TOUCH_SCREEN__) && !defined(__MMI_NO_HANDWRITING__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* defined(__MMI_TOUCH_SCREEN__) */ 

#ifdef __MMI_TIMEZONE_CHANGE_DATETIME__
    //ReadValue(NVRAM_AUTOUPDATE_DT_STATUS, &(g_phnset_cntx_p->curDTUpdateStatus), DS_BYTE, &Err);
	ReadValueSlim(NVRAM_AUTOUPDATE_DT_STATUS, &(g_phnset_cntx_p->curDTUpdateStatus), DS_BYTE);

    //if (g_phnset_cntx_p->curDTUpdateStatus == 0xFF || Err != NVRAM_READ_SUCCESS)
	if (g_phnset_cntx_p->curDTUpdateStatus == 0xFF)
    {
        g_phnset_cntx_p->curDTUpdateStatus = 0;
    }
#endif /* __MMI_TIMEZONE_CHANGE_DATETIME__ */

#ifdef __MMI_VUI_HOMESCREEN__
	//ReadValue(NVRAM_VUI_PHNSET_HOMESCREEN, &(g_phnset_cntx_p->vui_home_screen), DS_BYTE, &Err);
	ReadValueSlim(NVRAM_VUI_PHNSET_HOMESCREEN, &(g_phnset_cntx_p->vui_home_screen), DS_BYTE);
	
    //if (g_phnset_cntx_p->vui_home_screen == 0xFF || Err != NVRAM_READ_SUCCESS)
	if (g_phnset_cntx_p->vui_home_screen == 0xFF)
    {
        g_phnset_cntx_p->vui_home_screen = 1;
    }

	//WriteValue(NVRAM_VUI_PHNSET_HOMESCREEN, &(g_phnset_cntx_p->vui_home_screen), DS_BYTE, &Err);
	WriteValueSlim(NVRAM_VUI_PHNSET_HOMESCREEN, &(g_phnset_cntx_p->vui_home_screen), DS_BYTE);
#endif /* __MMI_VUI_HOMESCREEN__ */

#ifdef __MMI_VUI_MAINMENU__
	//ReadValue(NVRAM_VUI_PHNSET_MAINMENU_EFFECT, &(g_phnset_cntx_p->vui_mm_effect), DS_BYTE, &Err);
	ReadValueSlim(NVRAM_VUI_PHNSET_MAINMENU_EFFECT, &(g_phnset_cntx_p->vui_mm_effect), DS_BYTE);
	
    //if (g_phnset_cntx_p->vui_mm_effect == 0xFF || Err != NVRAM_READ_SUCCESS)
	 if (g_phnset_cntx_p->vui_mm_effect == 0xFF)
    {
        g_phnset_cntx_p->vui_mm_effect = 0;
    }

	//WriteValue(NVRAM_VUI_PHNSET_MAINMENU_EFFECT, &(g_phnset_cntx_p->vui_mm_effect), DS_BYTE, &Err);
	WriteValueSlim(NVRAM_VUI_PHNSET_MAINMENU_EFFECT, &(g_phnset_cntx_p->vui_mm_effect), DS_BYTE);
#endif /* __MMI_VUI_MAINMENU__ */
}
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif

/********/
/* Profile */
/********/
#ifndef __MMI_PHNSET_AT_DISABLE__
/*****************************************************************************
 * FUNCTION
 *  ATSetProfileHandler
 * DESCRIPTION
 *  AT command set profile
 * PARAMETERS
 *  msg     [?]     Wall paper/tone/home city/theme/short cut setting request
 * RETURNS
 *  void
 *****************************************************************************/
static void ATSetProfileHandler(void *msg, int mod_id)
{
#ifndef __SLIM_AT__    
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_set_mmi_default_prof_ind_struct *mmi_set_prof_struct = (mmi_set_mmi_default_prof_ind_struct*) msg;

    mmi_at_general_res_req_struct *msgReq;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    msgReq = (mmi_at_general_res_req_struct*) OslConstructDataPtr(sizeof(mmi_at_general_res_req_struct));
    msgReq->result = MMI_FALSE;

    if (mmi_set_prof_struct->op != 1)   /* Query command, not imlpemented, send response with error result to L4 */
    {
        goto MMILAB_ATSETPROF_END;
    }

    switch (mmi_set_prof_struct->category)
    {
        case 0: /* Wallpaper */
        {
            if (PhnsetSetDisplayFromAT((U8) (mmi_set_prof_struct->param3 - 1), (U8) MMI_PHNSET_TYPE_WP) == MMI_TRUE)
            {
                msgReq->result = MMI_TRUE;
            }

            break;
        }
        case 2: /* Home City */
        {
            if (ATSetHomeCity((U8) (mmi_set_prof_struct->param3)) == MMI_TRUE)
            {
                msgReq->result = MMI_TRUE;
            }

            break;
        }
    #if defined(__MMI_THEMES_APPLICATION__)
        case 3: /* Theme */
        {
            if (ATSetTheme((U8) (mmi_set_prof_struct->param3 - 1)) == MMI_TRUE)
            {
                msgReq->result = MMI_TRUE;
            }

            break;
        }
    #endif /* defined(__MMI_THEMES_APPLICATION__) */ 
    #ifndef __DISABLE_SHORTCUTS_IMPL__
        case 4: /* Shortcut */
        {
            if (ATSetShortcuts((PU8) mmi_set_prof_struct->param4) == MMI_TRUE)
            {
                msgReq->result = MMI_TRUE;
            }

            break;
        }
    #endif /* __DISABLE_SHORTCUTS_IMPL__ */ 
        case 5: /* Screen Saver */
        {
            if (PhnsetSetDisplayFromAT((U8) (mmi_set_prof_struct->param3 - 1), (U8) MMI_PHNSET_TYPE_SS) == MMI_TRUE)
            {
                msgReq->result = MMI_TRUE;
            }

            break;
        }
    #ifdef __MMI_POWER_ON_OFF_DISPLAY__
        case 6: /* Power On */
        {
            if (PhnsetSetDisplayFromAT((U8) (mmi_set_prof_struct->param3 - 1), (U8) MMI_PHNSET_TYPE_PWRON) == MMI_TRUE)
            {
                msgReq->result = MMI_TRUE;
            }

            break;
        }
        case 7: /* Power Off */
        {
            if (PhnsetSetDisplayFromAT((U8) (mmi_set_prof_struct->param3 - 1), (U8) MMI_PHNSET_TYPE_PWROFF) == MMI_TRUE)
            {
                msgReq->result = MMI_TRUE;
            }

            break;
        }
    #endif /* __MMI_POWER_ON_OFF_DISPLAY__ */ 
        default:
            msgReq->result = MMI_FALSE;
            break;
    }

  MMILAB_ATSETPROF_END:
    mmi_frm_send_ilm((oslModuleType)mod_id, MSG_ID_MMI_AT_GENERAL_RES_REQ, (oslParaType*)msgReq, NULL);
#endif /* __SLIM_AT__ */
}
#endif

#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTINGS_RODATA" , code = "DYNAMIC_CODE_SETTINGS_ROCODE"
#endif
/*****************************************************************************
 * FUNCTION
 *  InitPhoneSetupApp
 * DESCRIPTION
 *  This function is to register highlight handler for Phonesetup
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void InitPhoneSetupApp(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_TRACE(MMI_COMMON_TRC_G7_SETTING, MMI_PHNSET_INIT_PHONESETUP_APP);

#ifdef __MMI_CHANGABLE_FONT__
    PhnsetReadFontSize();   /* __USB_IN_NORMAL_MODE__ */
#endif /* __MMI_CHANGABLE_FONT__ */ 

/*    InitPhoneSetupGPIO(); */
#ifdef __MMI_TIMEZONE_SETTING__
#if !defined(__MMI_HIDE_HOMECITY__) && defined(__MMI_TWO_LAYER_HOMECITY__) 
    mmi_dt_init_gmt_tz_table();
#endif 
#endif /* __MMI_TIMEZONE_SETTING__ */
#ifndef __MMI_PHNSET_AT_DISABLE__
    mmi_phnset_init_at_handler();
#endif

#ifdef __MMI_VUI_LAUNCHER_KEY__
	mmi_phnset_shortcut_manager_init();	
	mmi_phnset_widget_manager_init();
#endif
#if (defined(__MMI_VUI_LAUNCHER_KEY__) || defined(__MMI_VUI_LAUNCHER__)) && defined(__MMI_VUI_MAIN_MENU_SWITCH_EFFECT__)
	mmi_phnset_menu_effect_init();
#endif
#ifdef __MMI_WEARABLE_DEVICE_SETTING__
#ifdef __HOTKNOT_SUPPORT__
	mmi_phnset_hotknot_init();
#endif
#endif
}

#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_init
 * DESCRIPTION
 *  use for DCM
 * PARAMETERS
 *  
 * RETURNS
 *  static void
 *****************************************************************************/

void mmi_phnset_init(void)
{
#ifdef __MMI_AP_DCM_SETTING__
  mmi_ap_send_dcm_load_evt(DYNAMIC_CODE_COMPRESS_SETTINGS);
#endif
  InitPhoneSetupCntx();
  InitPhoneSetupApp();
#ifdef __MMI_AP_DCM_SETTING__  
  mmi_ap_send_dcm_unload_evt(DYNAMIC_CODE_COMPRESS_SETTINGS);
#endif
}

#ifdef __MMI_WEARABLE_DEVICE_SETTING__
void mmi_language_autosync_init(void)
{
	kal_wap_trace(MOD_MMI_COMMON_APP,TRACE_GROUP_4,"[language]mmi_language_autosync_init");



#ifdef __MMI_BT_NOTI_SRV__
  srv_bt_noti_register_callback_ext(BT_NOTIFY_SYNC_LANGUAGE_CMD, 
                       BT_NOTIFY_SYNC_LANGUAGE_SENDER, 
                       mmi_phnset_language_auto_sync);
#endif


}

MMI_BOOL mmi_get_time_autosync_status(void)
{
	U8 set;
	
	ReadValueSlim(NVRAM_PHNSET_TIME_AUTO_SYNC_SETTING, &set, DS_BYTE);
	if(set == SETTING_TIME_AUTO_SYNC_ON)
	{
		return MMI_TRUE;
	}
	else
	{
		return MMI_FALSE;
	}

	
}

MMI_BOOL mmi_get_alm_autosync_status(void)
{
	U8 set;
	
	ReadValueSlim(NVRAM_ALARM_AUTO_SYNC, &set, DS_BYTE);
	if(set == SETTING_TIME_AUTO_SYNC_ON)
	{
		return MMI_TRUE;
	}
	else
	{
		return MMI_FALSE;
	}

	
}
#ifdef __MMI_BT_NOTI_SRV__
extern U16 gCurrLangIndex;
void mmi_phnset_language_auto_sync(void *data)
{
	U8 i;
	U8 language_idx;
	S8 *lang_code;
	U8 set = 0;

	
	//lang_code = "zh";
	srv_bt_noti_callback_struct *p_data = (srv_bt_noti_callback_struct*)data;
	
	//mmi_popup_display_ext(STR_ID_RESET_CONFIRM, MMI_EVENT_WARNING, NULL);

    kal_wap_trace(MOD_MMI_COMMON_APP,TRACE_GROUP_4,"[language]auto sync err_code = %d", p_data->err_code );
	/*data:zh*/
	/*error code:1*/
	if(p_data->err_code == 1)
	{
		kal_wap_trace(MOD_MMI_COMMON_APP, TRACE_GROUP_4,"[language]data = %x ", p_data->data.buffer.data);
		
		kal_wap_trace(MOD_MMI_COMMON_APP,TRACE_GROUP_4,"[language]auto sync,data = %s",p_data->data.buffer.data);
		if (p_data == NULL)
	    {
	        return;
	    }
		lang_code = (S8 *)(p_data->data.buffer.data);
		
		MMI_PRINT(MOD_MMI_COMMON_APP,TRACE_GROUP_4,"[language]auto sync,lang_code = %s", lang_code);

		ReadValueSlim(NVRAM_PHNSET_LANGUAGE_AUTO_SYNC_SETTING, &set, DS_BYTE);
		
		kal_wap_trace(MOD_MMI_COMMON_APP,TRACE_GROUP_4,"[language]auto sync,set = %d", set);
		if(set == SETTING_TIME_AUTO_SYNC_ON)
		{
			language_idx = mmi_get_language_index_by_lang_code(lang_code);
			
			kal_wap_trace(MOD_MMI_COMMON_APP, TRACE_GROUP_4, "[language]auto sync,language_idx = %d ", language_idx);
			kal_wap_trace(MOD_MMI_COMMON_APP, TRACE_GROUP_4, "[language]auto sync,gCurrLangIndex = %d ", gCurrLangIndex);
			if(language_idx != 0xFFFF && language_idx != gCurrLangIndex)
			{
				kal_wap_trace(MOD_MMI_COMMON_APP, TRACE_GROUP_4, "[language]auto sync,srv_setting_set_language");
				srv_setting_set_language(language_idx);
				mmi_frm_display_dummy_screen();
				mmi_frm_scrn_close_active_id();
			}
		}
	}

	
	return;
}
#endif
#endif


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_init_at_handler
 * DESCRIPTION
 *  Init AT handler for phone setting APP 
 * PARAMETERS
 *  
 * RETURNS
 *  static void
 *****************************************************************************/
#ifndef __MMI_PHNSET_AT_DISABLE__
static void mmi_phnset_init_at_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Language */
//    SetProtocolEventHandler(AtQueryLangIndHdlr, PRT_MMI_EQ_QUERY_LANGUAGE_REQ_IND);    
    SetProtocolEventHandler(ATSetLanguage, PRT_MMI_EQ_SET_LANGUAGE_REQ_IND);        

    /* Restore */
    SetProtocolEventHandler(ATRstFactoryDefault, PRT_MMI_FACTORY_RESTORE_REQ_IND);
    mmi_phnset_date_and_time_init_at_handler();
	
    SetProtocolEventHandler(ATSetProfileHandler, PRT_MMI_SET_MMI_DEFAULT_PROF_IND);
	
	/* flight mode */
#ifdef __MMI_TELEPHONY_SUPPORT__
    SetProtocolEventHandler(mmi_mode_switch_set_flight_mode_from_at, MSG_ID_MMI_NW_CFUN_STATE_REQ_IND);
#endif
}
#endif
#ifdef __MMI_WEARABLE_DEVICE_SETTING__
#ifdef __MMI_BT_NOTI_SRV__
 mmi_ret setting_spp_conn_event_handler(mmi_event_struct *evt)
 {
 	 U8 set = 0;
	 srv_bt_noti_connect_status_change_notify_struct *status_change_notify;
	 MMI_BOOL tipc_is_connected = MMI_FALSE;
	#ifdef __MMI_BLE_TIP_SUPPORT__
	 tipc_is_connected = mmi_tipc_is_connected();
	#endif
	 kal_wap_trace(MOD_MMI_COMMON_APP,TRACE_GROUP_2,"[phnsetup]setting_spp_conn_event_handler");
	   
	 if (evt->evt_id == EVT_ID_SRV_BT_NOTI_CONNECTION_STATUS_CHANGE)
	 {		 
		 status_change_notify = (srv_bt_noti_connect_status_change_notify_struct*)evt;
		 
		 if (status_change_notify->is_connected)
		 {
			 //spp connected
			if(SRC_ID_PHNSET_SCREEN == mmi_frm_scrn_get_active_id())
			{
				mmi_frm_display_dummy_screen();
				mmi_frm_scrn_close_active_id();
			}
			 kal_wap_trace(MOD_MMI_COMMON_APP,TRACE_GROUP_2,"[phnsetup]setting_spp_conn_event_handler, end");
		 }
		 else if(!tipc_is_connected)
		 {
			if(SRC_ID_PHNSET_SCREEN == mmi_frm_scrn_get_active_id())
			{
				mmi_frm_display_dummy_screen();
				mmi_frm_scrn_close_active_id();
			}
			else if (GetParentItemId(MENU_ID_TIME_AUTO_SYNC_ON)== MENU_ID_AUTO_SYNC)
			{
				mmi_frm_group_close(GRP_ID_PHNSET_TIME_AUTO_SYNC);
			}
			 kal_wap_trace(MOD_MMI_COMMON_APP,TRACE_GROUP_2,"[phnsetup]BT disconnected");
		 
		 }
	 }
 
	 return MMI_RET_OK;
 }
#endif
 mmi_ret mmi_tip_sync_connect_event_hdlr(mmi_event_struct *evt)
{
	/*----------------------------------------------------------------*/
	/* Local Variables                                                */
	/*----------------------------------------------------------------*/
	//cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
	U8 set = 0;
	/*----------------------------------------------------------------*/
	/* Code Body                                                      */
	/*----------------------------------------------------------------*/
    kal_prompt_trace(MOD_MMI, "[TIPC] connect_event_hdlr--cur: %d, evt: %d",
        EVT_ID_TIP_CONNECT, evt->evt_id);
	
	if(evt->evt_id == EVT_ID_TIP_CONNECT)
	{
		//set = SETTING_TIME_AUTO_SYNC_ON;

		//WriteValueSlim(NVRAM_PHNSET_TIME_AUTO_SYNC_SETTING, &set, DS_BYTE);
		if(SRC_ID_PHNSET_SCREEN == mmi_frm_scrn_get_active_id())
		{
			mmi_frm_display_dummy_screen();
			mmi_frm_scrn_close_active_id();
		}
	}

	return MMI_RET_OK;

}
mmi_ret mmi_tip_sync_disconnect_event_hdlr(mmi_event_struct *evt)
{
	/*----------------------------------------------------------------*/
	/* Local Variables                                                */
	/*----------------------------------------------------------------*/
	//cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
	U8 set = 0;
	MMI_BOOL spp_is_connected = MMI_FALSE;
	#ifdef __MMI_BT_NOTI_SRV__
	spp_is_connected = srv_bt_noti_check_sync_connection();
	#endif
    kal_prompt_trace(MOD_MMI, "[TIPC] disconnect_event_hdlr--cur: %d, evt: %d",
        EVT_ID_TIP_DISCONNECT, evt->evt_id);

	/*----------------------------------------------------------------*/
	/* Code Body                                                      */
	/*----------------------------------------------------------------*/
	if(evt->evt_id == EVT_ID_TIP_DISCONNECT && !spp_is_connected)
	{
		//set = SETTING_TIME_AUTO_SYNC_OFF;

		//WriteValueSlim(NVRAM_PHNSET_TIME_AUTO_SYNC_SETTING, &set, DS_BYTE);

		if(SRC_ID_PHNSET_SCREEN == mmi_frm_scrn_get_active_id())
		{
			mmi_frm_display_dummy_screen();
			mmi_frm_scrn_close_active_id();
		}
		else if (GetParentItemId(MENU_ID_TIME_AUTO_SYNC_ON)== MENU_ID_AUTO_SYNC)
		{
			mmi_frm_group_close(GRP_ID_PHNSET_TIME_AUTO_SYNC);
		}
		
	}

	return MMI_RET_OK;

}
#endif
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTINGS_RODATA" , code = "DYNAMIC_CODE_SETTINGS_ROCODE"
#endif
/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetScr
 * DESCRIPTION
 *  This function is highlight handler for Phonesetup
 *  Follow functions: EntryPhnsetScr
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightPhnsetScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* 1 Change left soft key icon and label */
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    /* 2 Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);

    /* 3 Register function for left soft key */
    SetLeftSoftkeyFunction(EntryPhnsetScr, KEY_EVENT_UP);
    SetCenterSoftkeyFunction(EntryPhnsetScr, KEY_EVENT_UP);
    /* 4 Register function for right soft key */
    //SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
}

#ifdef __MMI_WEARABLE_DEVICE_SETTING__
#ifdef __HOTKNOT_SUPPORT__
/*
void mmi_frm_hotknot_enable(void)
{
	
}
void mmi_frm_hotknot_disable(void)
{
	
}
*/
typedef struct
{
    mmi_id sg_id;
    MenucuiPtr LSK_function;
    MenucuiPtr CSK_function;
    MenucuiPtr RSK_function;
}mmi_confirm_user_data_struct;

mmi_confirm_user_data_struct g_mmi_hotknot_confirm_user_data;


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_hotknot_init
 * DESCRIPTION
 *  Init hotknot in phnset app. 
 * PARAMETERS
 *  
 * RETURNS
 *   void
 *****************************************************************************/
void mmi_phnset_hotknot_init(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 set;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	ReadValueSlim(NVRAM_HOTKNOT_SETTING, &set, DS_BYTE);
	if(set == SETTING_TIME_AUTO_SYNC_ON)
	{
		mmi_frm_hotknot_enable();
	}
	else
	{
		mmi_frm_hotknot_disable();
	}
}

/*****************************************************************************
 * FUNCTION
 *  hotknot_enable_set
 * DESCRIPTION
 *  set hotknot enbale in phnset app. 
 * PARAMETERS
 *  
 * RETURNS
 *   void
 *****************************************************************************/
void hotknot_enable_set(void)
{
	
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 set;
		
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	mmi_frm_hotknot_enable();
	set = SETTING_TIME_AUTO_SYNC_ON;
	WriteValueSlim(NVRAM_HOTKNOT_SETTING, &set, DS_BYTE);
	mmi_frm_group_close(GRP_ID_HOTKNOT_POWER_MENU);
	
}

static void mmi_hotknot_confirm_user_data_init(mmi_confirm_user_data_struct * arg)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    arg->sg_id = GRP_ID_INVALID;
    arg->LSK_function = NULL;
    arg->CSK_function = NULL;
    arg->RSK_function = NULL;
}

static mmi_ret mmi_hotknot_comfirm_proc(mmi_event_struct *evt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    switch (evt->evt_id)
    {
        case EVT_ID_ALERT_QUIT:
        {
            mmi_alert_result_evt_struct *alert = (mmi_alert_result_evt_struct *)evt;
            mmi_confirm_user_data_struct * confirm_data = 
                (mmi_confirm_user_data_struct *)alert->user_tag;
            MenucuiPtr LSK_function = confirm_data->LSK_function;
            MenucuiPtr RSK_function = confirm_data->RSK_function;

            switch (alert->result)
            {
                case MMI_ALERT_NORMAL_EXIT:
                    mmi_frm_group_close(alert->alert_id);
                    break;

                case MMI_ALERT_CNFM_OK:
                    if (LSK_function != NULL)
                    {
                        LSK_function(confirm_data->sg_id);
                    }
                    break;

                case MMI_ALERT_CNFM_CANCEL:
                    if (RSK_function != NULL)
                    {
                        RSK_function(confirm_data->sg_id);
                    }
                    break;

                default:
                    break;
            }
		
        }
		case EVT_ID_TOUCHSCREEN_MOVE_RIGHT:
		{
			hotknot_enable_set();
			break;
		}
    }

	return MMI_RET_OK;
}

static void mmi_hotknot_poweron_confirm(MMI_ID group_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_confirm_property_struct arg;
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	 mmi_confirm_property_init(&arg, CNFM_TYPE_OK);
     arg.parent_id = group_id;
     arg.callback = (mmi_proc_func)mmi_hotknot_comfirm_proc;
	 arg.f_enter_history = 1;
     mmi_hotknot_confirm_user_data_init(&g_mmi_hotknot_confirm_user_data);
     g_mmi_hotknot_confirm_user_data.sg_id = group_id;
     g_mmi_hotknot_confirm_user_data.LSK_function = hotknot_enable_set;

     arg.user_tag = (void *)&g_mmi_hotknot_confirm_user_data;

     mmi_confirm_display(
            (WCHAR *) get_string(STR_ID_HOTKNOT_TIP_STRING1),
            MMI_EVENT_QUERY,
            &arg);
}




static mmi_ret mmi_entry_hotknot_screen_proc(mmi_event_struct *param)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

	return MMI_RET_OK;	  
}

static void mmi_hotknot_highlight_hdlr(S32 item_index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    g_phnset_cntx_p->curHightlightItem = item_index;
}




static S32 HotknotUpdateItemData(S32 start_index, gui_iconlist_menu_item *menu_data, S32 num_items)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i,index;
	U8 set;
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	for (i = 0; i < num_items; i++)
    {
    	index = start_index + i;

		if(index == 0x00)
		{
			ReadValueSlim(NVRAM_HOTKNOT_SETTING, &set, DS_BYTE);
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_ID_HOTKNOT_POWER));
			if(set == SETTING_TIME_AUTO_SYNC_ON)
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_HOTKNOT_POWER_ON));
			}
			else
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_HOTKNOT_POWER_OFF));
			}

		}
		
	}

	return num_items;
}

static mmi_ret mmi_hotknot_power_proc(mmi_event_struct *evt)
{   
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
	U8 set = 0;
	mmi_menu_id highlight_menu;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

	switch (evt->evt_id)
	{
	case EVT_ID_CUI_MENU_LIST_ENTRY:
		if (menu_evt->parent_menu_id == MENU_HOTKNOT_POWER)
		{
		    ReadValueSlim(NVRAM_HOTKNOT_SETTING, &set, DS_BYTE);
			if(set == SETTING_TIME_AUTO_SYNC_ON)
			{
				highlight_menu = MENU_ID_HOTKNOT_POWER_ON;
			}
			else
			{
				highlight_menu = MENU_ID_HOTKNOT_POWER_OFF;
			}
			cui_menu_set_default_title_by_id(menu_evt->sender_id, STR_ID_HOTKNOT_POWER, NULL);
			cui_menu_set_currlist_flags(menu_evt->sender_id, CUI_MENU_NORMAL_RADIO_BUTTON_LIST);
			//cui_menu_set_currlist_flags(menu_evt->sender_id, CUI_MENU_LIST_WITH_SINGLE_TEXT_DOUBLE_ICON_ICON_TEXT_ICON);

			if (!mmi_frm_is_in_backward_scenario())
			{
				cui_menu_set_currlist_highlighted_id(menu_evt->sender_id, highlight_menu);
			}
            return MMI_RET_OK;
		}
		break;
	case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:
		if(menu_evt->highlighted_menu_id == MENU_ID_HOTKNOT_POWER_ON)
		{
			set = SETTING_TIME_AUTO_SYNC_ON;	
			mmi_hotknot_poweron_confirm(GRP_ID_HOTKNOT_POWER_MENU);
		}
		else
		{
			set = SETTING_TIME_AUTO_SYNC_OFF;
			mmi_frm_hotknot_disable();
			WriteValueSlim(NVRAM_HOTKNOT_SETTING, &set, DS_BYTE);
			mmi_frm_group_close(GRP_ID_HOTKNOT_POWER_MENU);
		}
		//set = menu_evt->highlighted_menu_id - MENU_ID_TIME_AUTO_SYNC_ON;
		break;

	
    case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        cui_menu_close(menu_evt->sender_id);
        return MMI_RET_OK;
		break;
        
    case EVT_ID_GROUP_DEINIT:

        return MMI_RET_OK;
		break;
		
	}
	 return MMI_RET_OK;
}

static void mmi_hotknot_power_menu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

	mmi_frm_group_create_ex(GRP_ID_HOTKNOT_MENU, 
        GRP_ID_HOTKNOT_POWER_MENU,
        mmi_hotknot_power_proc, 
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);

	cui_menu_create_and_run(
		GRP_ID_HOTKNOT_POWER_MENU,
		CUI_MENU_SRC_TYPE_RESOURCE, 
		CUI_MENU_TYPE_APPSUB,
		MENU_HOTKNOT_POWER,
		MMI_FALSE,
		NULL);
}

void mmi_hotknot_tap_callback(mmi_tap_type_enum tap_type, S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
   // if (tap_type == ENUM_TAP_ON_HIGHLIGHTED_ITEM)
    {
		if(index == 0x00)
    	{
    		mmi_hotknot_power_menu();
    	}	
    }
}

void EntryHotknotScr(void)
{
	/*----------------------------------------------------------------*/
	/* Local Variables												  */
	/*----------------------------------------------------------------*/
	U8 *gui_buffer = NULL;
	S32 highlighted_item = 0;
	
	/*----------------------------------------------------------------*/
	/* Code Body													  */
	/*----------------------------------------------------------------*/
	mmi_frm_group_create_ex(
		GRP_ID_SETTING_MAIN_MENU,//GRP_ID_ROOT,
		GRP_ID_HOTKNOT_MENU,
		mmi_entry_hotknot_screen_proc,
		NULL, 
		MMI_FRM_NODE_SMART_CLOSE_FLAG);
	
	if (!mmi_frm_scrn_enter(
		GRP_ID_HOTKNOT_MENU,
		SRC_ID_HOTKNOT_SCREEN,
		NULL,
		EntryHotknotScr,
		MMI_FRM_UNKNOW_SCRN))
	{
		return;
	}
	
	gui_buffer = mmi_frm_scrn_get_active_gui_buf();
	
	RegisterHighlightHandler(mmi_hotknot_highlight_hdlr);
	//wgui_fixed_list_register_get_flags_handler(mmi_phone_setup_timesync_flag);
	
	if (gui_buffer != NULL)
	{
		highlighted_item = g_phnset_cntx_p->curHightlightItem;
	}
	
	highlighted_item = g_phnset_cntx_p->curHightlightItem;
	
	wgui_swatch_two_line_menu_list_screen(
		(PU8)GetString(STR_ID_HOTKNOT),
		NULL,
		STR_GLOBAL_OK,
		NULL,
		STR_GLOBAL_BACK,
		1,
		HotknotUpdateItemData,
		highlighted_item,
		gui_buffer);
	
	SetRightSoftkeyFunction(mmi_frm_scrn_close_active_id, KEY_EVENT_UP);
#if defined(__MMI_TOUCH_SCREEN__)
	wgui_register_tap_callback(mmi_hotknot_tap_callback);
#endif 		
}

void HighlightHotknotScr(void)
{
	/*----------------------------------------------------------------*/
	/* Local Variables												  */
	/*----------------------------------------------------------------*/

	/*----------------------------------------------------------------*/
	/* Code Body													  */
	/*----------------------------------------------------------------*/
	/* 1 Change left soft key icon and label */
	ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
	/* 2 Change right soft key icon and label */
	ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);

	/* 3 Register function for left soft key */
	SetLeftSoftkeyFunction(EntryHotknotScr, KEY_EVENT_UP);
	SetCenterSoftkeyFunction(EntryHotknotScr, KEY_EVENT_UP);
	/* 4 Register function for right soft key */
	//SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
}
#else /*__HOTKNOT_SUPPORT__*/
void HighlightHotknotScr(void)
{
}
#endif /*__HOTKNOT_SUPPORT__*/
#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
extern void mmi_phnset_set_date_time_picker_save(void);
extern mmi_idle_swatch_context_struct *g_idle_swatch_p;

extern MMI_BOOL srv_alm_set_reminder(U8 index);

static void mmi_phnset_set_time_entry_picker(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    gui_picker_header *header;
    gui_picker_time_struct *picker_time;
    U8 picker_data[GUI_PICKER_STRUCT_MAX_SIZE] = {0};
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    header = (gui_picker_header*)picker_data;
    header->style = GUI_PICKER_STYLE_COSMOS;
    
    picker_time = (gui_picker_time_struct *)picker_data;
    header->type = GUI_PICKER_TYPE_TIME;
    picker_time->display_row = 5;
	DTGetRTCTime(&g_phnset_cntx_p->settime.prev_time);
	//GetDateTime(&g_phnset_cntx_p->settime.prev_time);
	g_phnset_cntx_p->settime.prev_time.nSec = 0;
    picker_time->hour = g_phnset_cntx_p->settime.prev_time.nHour;
    picker_time->minute = g_phnset_cntx_p->settime.prev_time.nMin;
		
	if(PhnsetGetTimeFormat())
	{
		picker_time->hour = g_phnset_cntx_p->settime.prev_time.nHour;
		picker_time->minute = g_phnset_cntx_p->settime.prev_time.nMin;
	}
	else
	{	//0:am;1:pm
		if(g_phnset_cntx_p->settime.prev_time.nHour == 12)
		{
			picker_time->hour = g_phnset_cntx_p->settime.prev_time.nHour;
			picker_time->minute = g_phnset_cntx_p->settime.prev_time.nMin;
			picker_time->am_pm = 1;
		}
		else if (g_phnset_cntx_p->settime.prev_time.nHour == 0)
		{
			picker_time->hour = 12;
			picker_time->minute = g_phnset_cntx_p->settime.prev_time.nMin;
			picker_time->am_pm = 0;
		}
		else if (g_phnset_cntx_p->settime.prev_time.nHour > 12)
		{
			picker_time->hour = g_phnset_cntx_p->settime.prev_time.nHour - 12;
			picker_time->minute = g_phnset_cntx_p->settime.prev_time.nMin;
			picker_time->am_pm = 1;
		}
		else
		{
			picker_time->hour = g_phnset_cntx_p->settime.prev_time.nHour;
			picker_time->minute = g_phnset_cntx_p->settime.prev_time.nMin;
			picker_time->am_pm = 0;
		}
	}

    #ifdef __MMI_TOUCH_SCREEN__
    picker_time->two_page = MMI_FALSE;
    #else
    picker_time->two_page = MMI_TRUE;
    #endif
    wgui_picker_entry((U8*)picker_data, GRP_ID_PHNSET_MENU, mmi_phnset_set_date_time_picker_save);
}

static void mmi_phnset_set_date_entry_picker(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    gui_picker_header *header;
    U8 picker_data[GUI_PICKER_STRUCT_MAX_SIZE] = {0};
    //gui_picker_month_and_day_struct *picker_month_and_day = (gui_picker_month_and_day_struct *)picker_data;
	gui_picker_date_struct *picker_year_month_and_day = (gui_picker_date_struct *)picker_data;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    header = (gui_picker_header*)picker_data;
	DTGetRTCTime(&g_phnset_cntx_p->settime.prev_time);
    header->style = GUI_PICKER_STYLE_COSMOS;

    header->type = GUI_PICKER_TYPE_DATE;
    picker_year_month_and_day->display_row = 5;
    picker_year_month_and_day->month = g_phnset_cntx_p->settime.prev_time.nMonth;
    picker_year_month_and_day->day = g_phnset_cntx_p->settime.prev_time.nDay;
	picker_year_month_and_day->current_year = g_phnset_cntx_p->settime.prev_time.nYear;

    #ifdef __MMI_TOUCH_SCREEN__
    picker_year_month_and_day->two_page = MMI_FALSE;
    #else
    picker_year_month_and_day->two_page = MMI_TRUE;
    #endif
	
	picker_year_month_and_day->min_year = YEARFORMATE;  //this must be YEARFORMATE
	picker_year_month_and_day->max_year = 2030;  //this should smaller than g_date_year_max in wgui_datetime.c
    wgui_picker_entry((U8*)picker_data, GRP_ID_PHNSET_MENU, mmi_phnset_set_date_time_picker_save);
}

static mmi_ret mmi_phnset_set_time_format_proc(mmi_event_struct *evt)
{
	cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;

	switch (evt->evt_id)
	{
	case EVT_ID_CUI_MENU_LIST_ENTRY:
		if (menu_evt->parent_menu_id == MENU_ID_SETTING_TIMEANDFORMAT)
		{
		    g_phnset_cntx_p->CurTimeFmt = (U8)srv_setting_get_time_format();
			cui_menu_set_default_title_by_id(menu_evt->sender_id, STR_PHONE_SETTING_CLOCK_TIME_FORMAT, NULL);
			cui_menu_set_currlist_flags(menu_evt->sender_id, CUI_MENU_NORMAL_RADIO_BUTTON_LIST);
			//cui_menu_set_currlist_flags(menu_evt->sender_id, CUI_MENU_LIST_WITH_SINGLE_TEXT_DOUBLE_ICON_ICON_TEXT_ICON);

			if (!mmi_frm_is_in_backward_scenario())
			{
				//cui_menu_set_currlist_highlighted_id(menu_evt->sender_id, g_phnset_cntx_p->CurTimeFmt);
				cui_menu_set_currlist_highlighted_id(menu_evt->sender_id, g_phnset_cntx_p->CurTimeFmt + MENU_ID_12_FORMAT);
			}
            return MMI_RET_OK;
		}
		break;
	case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:
		g_phnset_cntx_p->CurTimeFmt = menu_evt->highlighted_menu_id-MENU_ID_12_FORMAT;
		srv_setting_set_time_format((srv_setting_time_format_enum) g_phnset_cntx_p->CurTimeFmt);
		mmi_frm_group_close(GRP_ID_PHNSET_SET_TIME_AND_DATE_FORMAT);
		break;

	
    case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        cui_menu_close(menu_evt->sender_id);
        return MMI_RET_OK;
		break;
        
    case EVT_ID_GROUP_DEINIT:

        return MMI_RET_OK;
		break;
		
	}
	 return MMI_RET_OK;
}

static void mmi_phnset_entry_time_format_menu(void)
{
	mmi_frm_group_create_ex(GRP_ID_PHNSET_MENU, 
        GRP_ID_PHNSET_SET_TIME_AND_DATE_FORMAT,
        mmi_phnset_set_time_format_proc, 
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);
	//cui_gid = 
	cui_menu_create_and_run(
		GRP_ID_PHNSET_SET_TIME_AND_DATE_FORMAT,
		CUI_MENU_SRC_TYPE_RESOURCE, //CUI_MENU_SRC_TYPE_APPCREATE,	 __MMI_DEV_NEW_SLIM__
		CUI_MENU_TYPE_APPSUB,
		MENU_ID_SETTING_TIMEANDFORMAT,
		MMI_FALSE,
		NULL);
}



static mmi_ret mmi_phnset_time_auto_sync_proc(mmi_event_struct *evt)
{
	cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
	U8 set = 0;
	mmi_menu_id highlight_menu;

	switch (evt->evt_id)
	{
	case EVT_ID_CUI_MENU_LIST_ENTRY:
		if (menu_evt->parent_menu_id == MENU_ID_AUTO_SYNC)
		{
		    ReadValueSlim(NVRAM_PHNSET_TIME_AUTO_SYNC_SETTING, &set, DS_BYTE);
			if(set == SETTING_TIME_AUTO_SYNC_ON)
			{
				highlight_menu = MENU_ID_TIME_AUTO_SYNC_ON;
			}
			else
			{
				highlight_menu = MENU_ID_TIME_AUTO_SYNC_OFF;
			}
			cui_menu_set_default_title_by_id(menu_evt->sender_id, STR_ID_TIME_SYNC, NULL);
			cui_menu_set_currlist_flags(menu_evt->sender_id, CUI_MENU_NORMAL_RADIO_BUTTON_LIST);
			//cui_menu_set_currlist_flags(menu_evt->sender_id, CUI_MENU_LIST_WITH_SINGLE_TEXT_DOUBLE_ICON_ICON_TEXT_ICON);

			if (!mmi_frm_is_in_backward_scenario())
			{
				cui_menu_set_currlist_highlighted_id(menu_evt->sender_id, highlight_menu);
			}
            return MMI_RET_OK;
		}
		break;
	case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:
		if(menu_evt->highlighted_menu_id == MENU_ID_TIME_AUTO_SYNC_ON)
		{
			set = SETTING_TIME_AUTO_SYNC_ON;
			//srv_dt_set_time_sync_switch(MMI_TRUE);
			#ifdef __MMI_BLE_TIP_SUPPORT__
            mmi_bt_enable_tip_to_sync_time();
            #endif
  
		}
		else
		{
			set = SETTING_TIME_AUTO_SYNC_OFF;
			//srv_dt_set_time_sync_switch(MMI_FALSE);
			#ifdef __MMI_BLE_TIP_SUPPORT__
            mmi_bt_disable_tip_to_sync_time();
            #endif
		}
		//set = menu_evt->highlighted_menu_id - MENU_ID_TIME_AUTO_SYNC_ON;
		WriteValueSlim(NVRAM_PHNSET_TIME_AUTO_SYNC_SETTING, &set, DS_BYTE);
		mmi_frm_group_close(GRP_ID_PHNSET_TIME_AUTO_SYNC);
		break;

	
    case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        cui_menu_close(menu_evt->sender_id);
        return MMI_RET_OK;
		break;
        
    case EVT_ID_GROUP_DEINIT:

        return MMI_RET_OK;
		break;
		
	}
	 return MMI_RET_OK;
}

static void mmi_phnset_time_auto_sync_menu(void)
{
	mmi_frm_group_create_ex(GRP_ID_PHNSET_MENU, 
        GRP_ID_PHNSET_TIME_AUTO_SYNC,
        mmi_phnset_time_auto_sync_proc, 
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);

	cui_menu_create_and_run(
		GRP_ID_PHNSET_TIME_AUTO_SYNC,
		CUI_MENU_SRC_TYPE_RESOURCE, 
		CUI_MENU_TYPE_APPSUB,
		MENU_ID_AUTO_SYNC,
		MMI_FALSE,
		NULL);
}

enum {
//	INDEX_CLOCK_TYPE = 0x00,
//#ifdef __MMI_WEARABLE_DEVICE_ALARM_SYNC__	
//	INDEX_ALARM_SYNC,
//#endif	
	//INDEX_TIME_SYNC,
	INDEX_TIME_SYNC = 0x00,
	INDEX_DATE,
	INDEX_TIME,
	INDEX_TIME_FORMAT,
	INDEX_LAST1
}PHNSETUP_CLOCK_INDEX;
#ifdef __MMI_WEARABLE_DEVICE_ALARM_SYNC__
static mmi_ret mmi_alm_auto_sync_proc(mmi_event_struct *evt)
{
	//srv_bt_cm_bt_addr *bt_addr;
	//const srv_bt_cm_dev_struct* linked_dev = NULL;
	int i = 0;
	//U32 dev_count;
    //U32 idx;
	
	U8 data[40] = {0};
	cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
	mmi_menu_id highlight_menu;
	char cmd[32];
	char date[10];
	U8 len;
	U8 set = 0;

	switch (evt->evt_id)
	{
		case EVT_ID_CUI_MENU_LIST_ENTRY:
		if (menu_evt->parent_menu_id == MENU_ID_ALARM_SYNC)
		{
		    ReadValueSlim(NVRAM_ALARM_AUTO_SYNC, &set, DS_BYTE);
			if(set == SETTING_TIME_AUTO_SYNC_OFF)
			{
				highlight_menu = MENU_ID_ALARM_AUTO_SYNC_OFF;
			}
			else
			{
				highlight_menu = MENU_ID_ALARM_AUTO_SYNC_ON;
			}
			cui_menu_set_default_title_by_id(menu_evt->sender_id, STR_ID_ALM_SYNC, NULL);
			cui_menu_set_currlist_flags(menu_evt->sender_id, CUI_MENU_NORMAL_RADIO_BUTTON_LIST);
			//cui_menu_set_currlist_flags(menu_evt->sender_id, CUI_MENU_LIST_WITH_SINGLE_TEXT_DOUBLE_ICON_ICON_TEXT_ICON);

			if (!mmi_frm_is_in_backward_scenario())
			{
				cui_menu_set_currlist_highlighted_id(menu_evt->sender_id, highlight_menu);
			}
            return MMI_RET_OK;
		}
		break;
	case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:
		if(menu_evt->highlighted_menu_id == MENU_ID_ALARM_AUTO_SYNC_ON)
		{
			set = SETTING_TIME_AUTO_SYNC_ON;

			AlmDeactivateIndicator();
            /*
            dev_count = srv_bt_cm_get_linked_dev_list_idx();

			for (idx = 0; idx < dev_count; idx++)
		    {
		        linked_dev = srv_bt_cm_get_linked_dev_info(idx);
		        if (linked_dev != NULL)
		        {
		            kal_prompt_trace(MOD_MMI, "mmi_alm_auto_sync_proc sync alarm ON idx:%d", idx);
		            break;
		        }
		    }	

            //BT connected;
			if(linked_dev != NULL)
			{
				//bt_addr = &(((srv_bt_cm_dev_struct *)srv_bt_cm_get_linked_dev_info(0))->bd_addr);
				bt_addr = &(((srv_bt_cm_dev_struct *)linked_dev)->bd_addr);
				sprintf(cmd, "%s", BT_NOTIFY_SYNC_LANGUAGE_CMD);
				sprintf(date, "%s", "0 0");
				len = strlen(date);
				
				kal_prompt_trace(MOD_MMI_COMMON_APP, "len = %d ", strlen(date));
				sprintf(data, "%s %s %s",BT_NOTIFY_SYNC_ALARM_SENDERR,
					BT_NOTIFY_SYNC_ALARM_RECEIVER,"0 3 0 0");
				
				MMI_PRINT(MOD_MMI_COMMON_APP,TRACE_GROUP_4,"[language]auto sync,data = %s",data);
				//EXCD language mtk_language 1 0
				
				kal_wap_trace(MOD_MMI_COMMON_APP,TRACE_GROUP_4,"[language]send auto sync");
				srv_bt_noti_send_cmd_ext(bt_addr,cmd,data, strlen(data));
			}*/
        #ifdef __MMI_WEARABLE_DEVICE_ALARM__
			send_sync_alarm_cmd_to_sp();
		#endif

			//switch to ON: cancel local alarm from reminder;
			for(i = 0;i < NUM_OF_ALM-1;i++)
				srv_reminder_cancel(SRV_REMINDER_TYPE_ALM, i);
			
		}
		else
		{
			set = SETTING_TIME_AUTO_SYNC_OFF;

			//switch to OFF: cancel sync alarm from reminder;
			srv_reminder_cancel(SRV_REMINDER_TYPE_ALM, NUM_OF_ALM-1);

			//add local alarm to reminder;
			for(i = 0;i < NUM_OF_ALM-1;i++)
				srv_alm_set_reminder(i);
			if (srv_alm_active_alms() == 0)
            {
                AlmDeactivateIndicator();
            }
			else
			{
				AlmActivateIndicator();
			}
			
		}
		//set = menu_evt->highlighted_menu_id - MENU_ID_TIME_AUTO_SYNC_ON;
		WriteValueSlim(NVRAM_ALARM_AUTO_SYNC, &set, DS_BYTE);
		//mmi_phnset_language_auto_sync(NULL);
		mmi_frm_group_close(GRP_ID_ALM_AUTO_SYNC);
		break;

	
    case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        cui_menu_close(menu_evt->sender_id);
        return MMI_RET_OK;
		break;
        
    case EVT_ID_GROUP_DEINIT:

        return MMI_RET_OK;
		break;
		
	}
	 return MMI_RET_OK;
}


static void mmi_alm_auto_sync_menu(void)
{
	mmi_frm_group_create_ex(GRP_ID_PHNSET_MENU, 
        GRP_ID_ALM_AUTO_SYNC,
        mmi_alm_auto_sync_proc, 
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);

	cui_menu_create_and_run(
		GRP_ID_ALM_AUTO_SYNC,
		CUI_MENU_SRC_TYPE_RESOURCE, 
		CUI_MENU_TYPE_APPSUB,
		MENU_ID_ALARM_SYNC,
		MMI_FALSE,
		NULL);
}
#endif
void mmi_phnset_tap_callback(mmi_tap_type_enum tap_type, S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
   // if (tap_type == ENUM_TAP_ON_HIGHLIGHTED_ITEM)
    {
    #if 0
    	if(index == INDEX_CLOCK_TYPE)
    	{
    		 mmi_idle_swatch_setting(GRP_ID_PHNSET_MENU);
    	}
#ifdef __MMI_WEARABLE_DEVICE_ALARM_SYNC__	
		else if(index == INDEX_ALARM_SYNC)
    	{
			mmi_alm_auto_sync_menu();
		}
#endif
		else if(index == INDEX_TIME_SYNC)
#endif		
        if(index == INDEX_TIME_SYNC)
    	{
    		mmi_phnset_time_auto_sync_menu();
    	}
		else if(index == INDEX_DATE)
    	{
    		mmi_phnset_set_date_entry_picker();
    	}
		else if(index == INDEX_TIME)
    	{
    		mmi_phnset_set_time_entry_picker();
    	}
		else if(index == INDEX_TIME_FORMAT)
    	{
    		mmi_phnset_entry_time_format_menu();
    	}
							
		   
    }
}

static S32 PhnsetUpdateItemData(S32 start_index, gui_iconlist_menu_item *menu_data, S32 num_items)
{
	U8 i,index;
	WCHAR *feqstring ;
	CHAR *temp_string;
	U8 set;
	MYTIME setupTime;
	WCHAR setup_time[20]={0};

	//GetDateTime(&g_phnset_cntx_p->settime.prev_time);
	DTGetRTCTime(&g_phnset_cntx_p->settime.prev_time);
	
    kal_wap_trace(MOD_MMI_CONN_APP,TRACE_GROUP_4,"[time]get rtc time");
	for (i = 0; i < num_items; i++)
    {
    	index = start_index + i;
#ifndef __MMI_MAINLCD_128X128__
#if 0	

		if(index == INDEX_CLOCK_TYPE)
		{
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_PHONE_SETTING_CLOCK_TYPE));
			if(g_idle_swatch_p->swatch_index == 0x00)
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_PHONE_SETTING_CLOCK_TYPE_ANALOG));
			}
			else if(g_idle_swatch_p->swatch_index == 0x01)
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_PHONE_SETTING_CLOCK_TYPE_DIGITAL_WHITE));
			}
			else if(g_idle_swatch_p->swatch_index == 0x02)
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_PHONE_SETTING_CLOCK_TYPE_ROMAN_BLACK));
			}
			else if(g_idle_swatch_p->swatch_index == 0x03)
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_PHONE_SETTING_CLOCK_TYPE_ROMAN_WHITE));
			}
			else
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_PHONE_SETTING_CLOCK_TYPE_DIGITAL_RED));
			}
		}
#ifdef __MMI_WEARABLE_DEVICE_ALARM_SYNC__	
		else if(index == INDEX_ALARM_SYNC)
		{
			ReadValueSlim(NVRAM_ALARM_AUTO_SYNC, &set, DS_BYTE);
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_ID_ALM_SYNC));
			if(set == SETTING_TIME_AUTO_SYNC_ON)
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_TIME_AUTO_SYNC_ON));
			}
			else
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_TIME_AUTO_SYNC_OFF));
			}
		}
#endif
#endif
		//else if(index == INDEX_TIME_SYNC)
		if(index == INDEX_TIME_SYNC)
		{
			ReadValueSlim(NVRAM_PHNSET_TIME_AUTO_SYNC_SETTING, &set, DS_BYTE);
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_ID_TIME_SYNC));
			if(set == SETTING_TIME_AUTO_SYNC_ON)
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_TIME_AUTO_SYNC_ON));
			}
			else
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_TIME_AUTO_SYNC_OFF));
			}
		}
		else if(index == INDEX_DATE)
		{
			memset(g_phnset_cntx_p->settime.monthday_text, 0, 40);
			kal_wsprintf((WCHAR*)g_phnset_cntx_p->settime.monthday_text, "%04d.%02d.%02d",g_phnset_cntx_p->settime.prev_time.nYear, g_phnset_cntx_p->settime.prev_time.nMonth, g_phnset_cntx_p->settime.prev_time.nDay);
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_PHONE_SETTING_CLOCK_DATE));
			mmi_wcscpy((WCHAR*)menu_data[i].item_list[1], (WCHAR*)g_phnset_cntx_p->settime.monthday_text);
		}
		else if(index == INDEX_TIME)
		{
			//GetDateTime(&g_phnset_cntx_p->settime.prev_time);
			g_phnset_cntx_p->settime.prev_time.nSec = 0;
			//memset(g_phnset_cntx_p->settime.time_text, 0, 40);
			setupTime.nHour = g_phnset_cntx_p->settime.prev_time.nHour;
			kal_prompt_trace(MOD_NIL,"setupTime.nHour:%d",setupTime.nHour);
        	setupTime.nMin = g_phnset_cntx_p->settime.prev_time.nMin;
			time_string(&setupTime, (UI_string_type)setup_time, DT_IDLE_SCREEN);
			//kal_wsprintf((WCHAR*)g_phnset_cntx_p->settime.time_text, "%02d : %02d", g_phnset_cntx_p->settime.prev_time.nHour, g_phnset_cntx_p->settime.prev_time.nMin);
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_PHONE_SETTING_CLOCK_TIME));
			mmi_wcscpy((WCHAR*)menu_data[i].item_list[1], (WCHAR*)setup_time);
		}
		else if(index == INDEX_TIME_FORMAT)
		{
			g_phnset_cntx_p->CurTimeFmt = (U8)srv_setting_get_time_format();
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_PHONE_SETTING_CLOCK_TIME_FORMAT));
			if(0x00 == g_phnset_cntx_p->CurTimeFmt)
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_PHONE_SETTING_12_FORMAT));
			}
			else
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_PHONE_SETTING_24_FORMAT));
			}
		}
	#else
		if(index == 0x00)
		{
			memset(g_phnset_cntx_p->settime.monthday_text, 0, 40);
			kal_wsprintf((WCHAR*)g_phnset_cntx_p->settime.monthday_text, "%04d.%02d.%02d",g_phnset_cntx_p->settime.prev_time.nYear, g_phnset_cntx_p->settime.prev_time.nMonth, g_phnset_cntx_p->settime.prev_time.nDay);
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_PHONE_SETTING_CLOCK_DATE));
			mmi_wcscpy((WCHAR*)menu_data[i].item_list[1], (WCHAR*)g_phnset_cntx_p->settime.monthday_text);
		}
		else if(index == 0x01)
		{
			//GetDateTime(&g_phnset_cntx_p->settime.prev_time);
			g_phnset_cntx_p->settime.prev_time.nSec = 0;
			//memset(g_phnset_cntx_p->settime.time_text, 0, 40);
			setupTime.nHour = g_phnset_cntx_p->settime.prev_time.nHour;
        	setupTime.nMin = g_phnset_cntx_p->settime.prev_time.nMin;
			time_string(&setupTime, (UI_string_type)setup_time, DT_IDLE_SCREEN);
			//kal_wsprintf((WCHAR*)g_phnset_cntx_p->settime.time_text, "%02d : %02d", g_phnset_cntx_p->settime.prev_time.nHour, g_phnset_cntx_p->settime.prev_time.nMin);
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_PHONE_SETTING_CLOCK_TIME));
			mmi_wcscpy((WCHAR*)menu_data[i].item_list[1], (WCHAR*)setup_time);
		}
	#endif
	}

	return num_items;
}

static void mmi_phnset_highlight_hdlr(S32 item_index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    g_phnset_cntx_p->curHightlightItem = item_index;
#ifdef __MMI_MAINLCD_128X128__

	if(item_index == 0x00)
    {
        mmi_frm_set_key_handler(mmi_phnset_set_date_entry_picker,KEY_LSK,KEY_EVENT_UP);
		//SetLeftSoftkeyFunction(mmi_phnset_set_date_entry_picker, KEY_EVENT_UP);
    	
    }
	else if(item_index == 0x01)
    {
		
		SetLeftSoftkeyFunction(mmi_phnset_set_time_entry_picker, KEY_EVENT_UP);
		
    }
#endif
}

//the item become gray,when time sync is on
static MMI_BOOL mmi_phone_setup_timesync_flag(S32 index, U32* flag, U32* flag_ex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	U8 set;
	MMI_BOOL spp_is_connected = MMI_FALSE;
	#ifdef __MMI_BT_NOTI_SRV__
	spp_is_connected = srv_bt_noti_check_sync_connection();
	#endif
#ifdef __MMI_BLE_TIP_SUPPORT__
    if (mmi_tipc_is_connected() || spp_is_connected)
    {
	ReadValueSlim(NVRAM_PHNSET_TIME_AUTO_SYNC_SETTING, &set, DS_BYTE);
	if(set == SETTING_TIME_AUTO_SYNC_ON)
	{
		if (index >= INDEX_DATE && index <= INDEX_TIME_FORMAT)
			*flag |= UI_MENUITEM_STATE_DISABLED;
	}
    }
    else
#endif
    {
        if (index == INDEX_TIME_SYNC)
            *flag |= UI_MENUITEM_STATE_DISABLED;
    }
    return MMI_TRUE;
}
static mmi_ret mmi_entry_phnset_screen_proc(mmi_event_struct *param)
{
    return MMI_RET_OK;    
}

void EntryPhnsetScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	U8 itemnum;
	U8 *gui_buffer = NULL;
	S32 highlighted_item = 0;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_group_create_ex(
        GRP_ID_SETTING_MAIN_MENU,//GRP_ID_ROOT,
        GRP_ID_PHNSET_MENU,
        mmi_entry_phnset_screen_proc,
        NULL, 
        MMI_FRM_NODE_SMART_CLOSE_FLAG);
    
	if (!mmi_frm_scrn_enter(
		GRP_ID_PHNSET_MENU,
		SRC_ID_PHNSET_SCREEN,
		NULL,
		EntryPhnsetScr,
		MMI_FRM_UNKNOW_SCRN))
	{
		return;
	}
	
	gui_buffer = mmi_frm_scrn_get_active_gui_buf();
	
	RegisterHighlightHandler(mmi_phnset_highlight_hdlr);
	wgui_fixed_list_register_get_flags_handler(mmi_phone_setup_timesync_flag);
	
	if (gui_buffer != NULL)
	{
		highlighted_item = g_phnset_cntx_p->curHightlightItem;
	}
	highlighted_item = 0;
	//highlighted_item = g_phnset_cntx_p->curHightlightItem;
#ifdef __MMI_WEARABLE_DEVICE_ALARM_SYNC__	
	itemnum = 6;
#else
	itemnum = 4;//5;
#endif
	
	wgui_swatch_two_line_menu_list_screen(
		(PU8)GetString(STR_PHONE_SETTING_CLOCK),
		NULL,
		STR_GLOBAL_OK,
		NULL,
		STR_GLOBAL_BACK,
		itemnum,
		PhnsetUpdateItemData,
		highlighted_item,
		gui_buffer);
	
	SetRightSoftkeyFunction(mmi_frm_scrn_close_active_id, KEY_EVENT_UP);
	
#if defined(__MMI_FTE_SUPPORT__) && defined(__MMI_TOUCH_SCREEN__)
	wgui_register_tap_callback(mmi_phnset_tap_callback);
#endif  
}

#ifdef __MMI_MAINLCD_128X128__

void mmi_setting_entry_date_time_menu_int(mmi_scrn_essential_struct *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	U8 *gui_buffer = NULL;
	S32 highlighted_item = 0;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!mmi_frm_scrn_enter(GRP_ID_SETTING_MAIN_MENU, SCR9000_SETTINGS, NULL, (FuncPtr)mmi_setting_entry_date_time_menu_int, MMI_FRM_UNKNOW_SCRN))
    {
        return;
    }

	
	gui_buffer = mmi_frm_scrn_get_active_gui_buf();
	
	RegisterHighlightHandler(mmi_phnset_highlight_hdlr);
	wgui_fixed_list_register_get_flags_handler(mmi_phone_setup_timesync_flag);
	
	if (gui_buffer != NULL)
	{
		highlighted_item = g_phnset_cntx_p->curHightlightItem;
	}
	
	highlighted_item = g_phnset_cntx_p->curHightlightItem;
	
	wgui_swatch_two_line_menu_list_screen(
		(PU8)GetString(STR_PHONE_SETTING_CLOCK),
		NULL,
		STR_GLOBAL_OK,
		NULL,
		STR_GLOBAL_BACK,
		2,
		PhnsetUpdateItemData,
		highlighted_item,
		gui_buffer);
	
	SetRightSoftkeyFunction(mmi_frm_scrn_close_active_id, KEY_EVENT_UP);
	
#if defined(__MMI_FTE_SUPPORT__) && defined(__MMI_TOUCH_SCREEN__)
	wgui_register_tap_callback(mmi_phnset_tap_callback);
#endif  
}

#endif
#if defined(__MMI_PHB_LAST_NAME_FIELD__) && defined(__MMI_BT_PBAP_CLIENT__)
static mmi_ret mmi_phb_name_display_proc(mmi_event_struct *evt)
{
	S32 order;
	cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
	mmi_menu_id highlight_menu;
	

	switch (evt->evt_id)
	{
	case EVT_ID_CUI_MENU_LIST_ENTRY:
		if (menu_evt->parent_menu_id == MENU_SETTING_PHB_NAME_DISPLAY)
		{		
			order = srv_phb_pbapc_get_name_order(SRV_PHB_PBAPC_BTD_1ST);
			if(order == SRV_PHB_PBAPC_NAME_ORDER_1)
			{
				highlight_menu = MENU_ID_PHB_LAST_NAME_FIRST;
			}
			else
			{
				highlight_menu = MENU_ID_PHB_FIRST_NAME_FIRST;
			}

			cui_menu_set_default_title_by_id(menu_evt->sender_id, STR_PHB_NAME_DISPLAY, NULL);
			cui_menu_set_currlist_flags(menu_evt->sender_id, CUI_MENU_NORMAL_RADIO_BUTTON_LIST);
			//cui_menu_set_currlist_flags(menu_evt->sender_id, CUI_MENU_LIST_WITH_SINGLE_TEXT_DOUBLE_ICON_ICON_TEXT_ICON);

			if (!mmi_frm_is_in_backward_scenario())
			{
				cui_menu_set_currlist_highlighted_id(menu_evt->sender_id, highlight_menu);
			}
            return MMI_RET_OK;
		}
		break;
	case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:
		if(menu_evt->highlighted_menu_id == MENU_ID_PHB_LAST_NAME_FIRST)
		{
			srv_phb_pbapc_set_name_order(SRV_PHB_PBAPC_BTD_1ST, SRV_PHB_PBAPC_NAME_ORDER_1);
		}
		else
		{
			srv_phb_pbapc_set_name_order(SRV_PHB_PBAPC_BTD_1ST, SRV_PHB_PBAPC_NAME_ORDER_2);
		}
		mmi_frm_group_close(GRP_ID_PHB_NAME_DISPLAY);
		break;

	
    case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        cui_menu_close(menu_evt->sender_id);
        return MMI_RET_OK;
		break;
        
    case EVT_ID_GROUP_DEINIT:

        return MMI_RET_OK;
		break;
		
	}
	 return MMI_RET_OK;
}

static void mmi_phb_name_display_menu(void)
{
	mmi_frm_group_create_ex(GRP_ID_LANGUAGE_MENU, 
        GRP_ID_PHB_NAME_DISPLAY,
        mmi_phb_name_display_proc, 
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);

	cui_menu_create_and_run(
		GRP_ID_PHB_NAME_DISPLAY,
		CUI_MENU_SRC_TYPE_RESOURCE, 
		CUI_MENU_TYPE_APPSUB,
		MENU_SETTING_PHB_NAME_DISPLAY,
		MMI_FALSE,
		NULL);
}

#endif
static mmi_ret mmi_phnset_language_auto_sync_proc(mmi_event_struct *evt)
{
	srv_bt_cm_bt_addr *bt_addr;
	U8 data[40] = {0};
	cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)evt;
	mmi_menu_id highlight_menu;
	char cmd[32];
	char date[10];
	U8 len;
	U8 set = 0;

	switch (evt->evt_id)
	{
	case EVT_ID_CUI_MENU_LIST_ENTRY:
		if (menu_evt->parent_menu_id == MENU_ID_LANGUAGE_AUTO_SYNC)
		{
		    ReadValueSlim(NVRAM_PHNSET_LANGUAGE_AUTO_SYNC_SETTING, &set, DS_BYTE);
			if(set == SETTING_TIME_AUTO_SYNC_OFF)
			{
				highlight_menu = MENU_ID_LANGUAGE_AUTO_SYNC_OFF;
			}
			else
			{
				highlight_menu = MENU_ID_LANGUAGE_AUTO_SYNC_ON;
			}
			cui_menu_set_default_title_by_id(menu_evt->sender_id, STR_PHONE_SETTING_AUTO_SYNC, NULL);
			cui_menu_set_currlist_flags(menu_evt->sender_id, CUI_MENU_NORMAL_RADIO_BUTTON_LIST);
			//cui_menu_set_currlist_flags(menu_evt->sender_id, CUI_MENU_LIST_WITH_SINGLE_TEXT_DOUBLE_ICON_ICON_TEXT_ICON);

			if (!mmi_frm_is_in_backward_scenario())
			{
				cui_menu_set_currlist_highlighted_id(menu_evt->sender_id, highlight_menu);
			}
            return MMI_RET_OK;
		}
		break;
	case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:
		if(menu_evt->highlighted_menu_id == MENU_ID_LANGUAGE_AUTO_SYNC_ON)
		{
			set = SETTING_TIME_AUTO_SYNC_ON;
		//#ifdef __MMI_BT_SUPPORT__	
		//	bt_addr = &(((srv_bt_cm_dev_struct *)srv_bt_cm_get_linked_dev_info(0))->bd_addr);
		//#endif	
			sprintf(cmd, "%s", BT_NOTIFY_SYNC_LANGUAGE_CMD);
			sprintf(date, "%s", "1 0");
			len = strlen(date);
			
			kal_prompt_trace(MOD_MMI_COMMON_APP, "len = %d ", strlen(date));
			sprintf(data, "%s %s %s",BT_NOTIFY_SYNC_LANGUAGE_SENDER,
				BT_NOTIFY_SYNC_LANGUAGE_RECEIVER,"0 3 1 0");
			
			MMI_PRINT(MOD_MMI_COMMON_APP,TRACE_GROUP_4,"[language]auto sync,data = %s",data);
			/*EXCD language mtk_language 1 0*/
			
			kal_wap_trace(MOD_MMI_COMMON_APP,TRACE_GROUP_4,"[language]send auto sync");
		//#ifdef __MMI_BT_NOTI_SRV__
		//	srv_bt_noti_send_cmd_ext(bt_addr,cmd,data, strlen(data));
		//#endif
			
		}
		else
		{
			set = SETTING_TIME_AUTO_SYNC_OFF;
		}
		//set = menu_evt->highlighted_menu_id - MENU_ID_TIME_AUTO_SYNC_ON;
		WriteValueSlim(NVRAM_PHNSET_LANGUAGE_AUTO_SYNC_SETTING, &set, DS_BYTE);
		//mmi_phnset_language_auto_sync();
		mmi_frm_group_close(GRP_ID_PHNSET_LANGUAGE_AUTO_SYNC);
		break;

	
    case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        cui_menu_close(menu_evt->sender_id);
        return MMI_RET_OK;
		break;
        
    case EVT_ID_GROUP_DEINIT:

        return MMI_RET_OK;
		break;
		
	}
	 return MMI_RET_OK;
}

static void mmi_phnset_language_auto_sync_menu(void)
{
	mmi_frm_group_create_ex(GRP_ID_LANGUAGE_MENU, 
        GRP_ID_PHNSET_LANGUAGE_AUTO_SYNC,
        mmi_phnset_language_auto_sync_proc, 
        NULL,
        MMI_FRM_NODE_SMART_CLOSE_FLAG);

	cui_menu_create_and_run(
		GRP_ID_PHNSET_LANGUAGE_AUTO_SYNC,
		CUI_MENU_SRC_TYPE_RESOURCE, 
		CUI_MENU_TYPE_APPSUB,
		MENU_ID_LANGUAGE_AUTO_SYNC,
		MMI_FALSE,
		NULL);
}

void mmi_language_tap_callback(mmi_tap_type_enum tap_type, S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
   // if (tap_type == ENUM_TAP_ON_HIGHLIGHTED_ITEM)
    {
    	if(index == 0x00)
    	{
    		mmi_phnset_language_auto_sync_menu();
    		
    	}
		else if(index == 0x01)
    	{
    		mmi_phnset_entry_set_language(GRP_ID_LANGUAGE_MENU);
    	}	   
#if defined(__MMI_PHB_LAST_NAME_FIELD__) && defined(__MMI_BT_PBAP_CLIENT__)
		else if(index == 0x02)
    	{
    		mmi_phb_name_display_menu();
    	}
		#endif
    }
}

static S32 LanguageUpdateItemData(S32 start_index, gui_iconlist_menu_item *menu_data, S32 num_items)
{
	U8 i,index;
	U8 set;
	WCHAR* hint_str;
	S32 order;
	
	for (i = 0; i < num_items; i++)
    {
    	index = start_index + i;
		if(index == 0x00)
		{
			ReadValueSlim(NVRAM_PHNSET_LANGUAGE_AUTO_SYNC_SETTING, &set, DS_BYTE);
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_PHONE_SETTING_AUTO_SYNC));
			if(set == SETTING_TIME_AUTO_SYNC_ON)
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_TIME_AUTO_SYNC_ON));
			}
			else
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_TIME_AUTO_SYNC_OFF));
			}
		}
		else if(index == 0x01)
		{
			hint_str = (WCHAR*)gLanguageArray[gCurrLangIndex].aName;
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_MENU_LANGUAGE));
			mmi_wcscpy((WCHAR*)menu_data[i].item_list[1], (WCHAR*)hint_str);
		}
#if defined(__MMI_PHB_LAST_NAME_FIELD__) && defined(__MMI_BT_PBAP_CLIENT__)
		else if(index == 0x02)
		{
			order = srv_phb_pbapc_get_name_order(SRV_PHB_PBAPC_BTD_1ST);
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_PHB_NAME_DISPLAY));
			if(order == SRV_PHB_PBAPC_NAME_ORDER_1)
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_PHB_LAST_NAME_FIRST));
			}
			else
			{
				mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(STR_PHB_FIRST_NAME_FIRST));
			}
		}
	#endif
	}
	return num_items;
}

static void ExitLanguageScr(void)
{
     /*----------------------------------------------------------------*/
     /* Local Variables                                                */
     /*----------------------------------------------------------------*/

     /*----------------------------------------------------------------*/
     /* Code Body                                                      */
     /*----------------------------------------------------------------*/
 
	mmi_frm_group_close(GRP_ID_LANGUAGE_MENU);
}

static MMI_BOOL mmi_phone_setup_language_sync_flag(S32 index, U32* flag, U32* flag_ex)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	U8 set;

	ReadValueSlim(NVRAM_PHNSET_LANGUAGE_AUTO_SYNC_SETTING, &set, DS_BYTE);
	if(set == SETTING_TIME_AUTO_SYNC_ON)
	{
		if (index == 0x01)
			*flag |= UI_MENUITEM_STATE_DISABLED;
	}
    return MMI_TRUE;
}

static mmi_ret mmi_entry_language_screen_proc(mmi_event_struct *param)
{
    return MMI_RET_OK;    
}
static void EntryLanguageScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	U8 menuitem;
	U8 *gui_buffer = NULL;
	S32 highlighted_item = 0;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_group_create_ex(
        GRP_ID_ROOT,
        GRP_ID_LANGUAGE_MENU,
        mmi_entry_language_screen_proc,
        NULL, 
        MMI_FRM_NODE_SMART_CLOSE_FLAG);
    
	if (!mmi_frm_scrn_enter(
		GRP_ID_LANGUAGE_MENU,
		SRC_ID_LANGUAGE_SCREEN,
		NULL,
		EntryLanguageScr,
		MMI_FRM_UNKNOW_SCRN))
	{
		return;
	}
	
	gui_buffer = mmi_frm_scrn_get_active_gui_buf();
	
	RegisterHighlightHandler(mmi_phnset_highlight_hdlr);
	wgui_fixed_list_register_get_flags_handler(mmi_phone_setup_language_sync_flag);
	
	if (gui_buffer != NULL)
	{
		highlighted_item = g_phnset_cntx_p->curHightlightItem;
	}
	
	highlighted_item = g_phnset_cntx_p->curHightlightItem;
#if defined(__MMI_PHB_LAST_NAME_FIELD__) && defined(__MMI_BT_PBAP_CLIENT__)
		menuitem = 3;
	#else
		menuitem = 2;
	#endif
	
	wgui_swatch_two_line_menu_list_screen(
		(PU8)GetString(STR_MENU_INTERNATIONAL),
		NULL,
		STR_GLOBAL_OK,
		NULL,
		STR_GLOBAL_BACK,
		menuitem,
		LanguageUpdateItemData,
		highlighted_item,
		gui_buffer);

	SetRightSoftkeyFunction(mmi_frm_scrn_close_active_id, KEY_EVENT_UP);

#if defined(__MMI_FTE_SUPPORT__) && defined(__MMI_TOUCH_SCREEN__)
	wgui_register_tap_callback(mmi_language_tap_callback);
#endif  
}

void HighlightLanguageScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* 1 Change left soft key icon and label */
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    /* 2 Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);

    /* 3 Register function for left soft key */
    SetLeftSoftkeyFunction(EntryLanguageScr, KEY_EVENT_UP);
    SetCenterSoftkeyFunction(EntryLanguageScr, KEY_EVENT_UP);
    /* 4 Register function for right soft key */
    //SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
}

#ifdef __MMI_BACKLIGHT_SUPPORT__
mmi_pen_point_struct pin_down;
//U8 set;
static void mmi_phnset_display_brightness_down(mmi_pen_point_struct pos)
{
	S32 layoutx;
	S32 str_w, str_h;
	S32 string_region;
	string_region = LCD_WIDTH;
	pin_down = pos;

	gdi_layer_push_and_set_active(swatch_dispaly_cell_info.cell_layer_handler);
	gdi_layer_lock_frame_buffer();

	gdi_layer_push_and_set_clip(
		     0, 111,
		     240,
		     240);
	gdi_layer_set_source_key(MMI_TRUE,GDI_COLOR_TRANSPARENT);
	gdi_layer_clear(GDI_COLOR_TRANSPARENT);
#if (defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
	if(((pin_down.x < 78) && (pin_down.x > 38)) && ((pin_down.y < 142) && (pin_down.y > 112)))
		{
		if(g_phnset_gpio_cntx_p->bl_setting_level>1)
		{
		gdi_image_draw_id(38, 112, IMG_SETTING_BRIGHTNESS_DECREASE_PRESSED);
		}
		else
		{
			gdi_image_draw_id(38, 112, IMG_SETTING_BRIGHTNESS_DECREASE);
		}
		gdi_image_draw_id(177, 112, IMG_SETTING_BRIGHTNESS_INCREASE);
		gdi_draw_solid_rect(0,180,240,240,gdi_act_color_from_rgb(255, 255, 150, 0));
		}
	else if(((pin_down.x < 209) && (pin_down.x > 177)) && ((pin_down.y < 142) && (pin_down.y > 112)))
		{
		gdi_image_draw_id(38, 112, IMG_SETTING_BRIGHTNESS_DECREASE);
		if(g_phnset_gpio_cntx_p->bl_setting_level<5)
		{
		gdi_image_draw_id(177, 112, IMG_SETTING_BRIGHTNESS_INCREASE_PRESSED);
		}
		else
		{
			gdi_image_draw_id(177, 112, IMG_SETTING_BRIGHTNESS_INCREASE);
		}
		gdi_draw_solid_rect(0,180,240,240,gdi_act_color_from_rgb(255, 255, 150, 0));
		}
	else if(((pin_down.x < 240) && (pin_down.x > 0)) && ((pin_down.y < 240) && (pin_down.y > 180)))
		{
		gdi_image_draw_id(38, 112, IMG_SETTING_BRIGHTNESS_DECREASE);
		gdi_image_draw_id(177, 112, IMG_SETTING_BRIGHTNESS_INCREASE);
		gdi_draw_solid_rect(0,180,240,240,gdi_act_color_from_rgb(255, 127, 75, 0));
		gui_set_text_color(gui_color(255, 255, 255));
		}
	else
		{
		gdi_image_draw_id(38, 112, IMG_SETTING_BRIGHTNESS_DECREASE);
		gdi_image_draw_id(177, 112, IMG_SETTING_BRIGHTNESS_INCREASE);
		gdi_draw_solid_rect(0,180,240,240,gdi_act_color_from_rgb(255, 255, 150, 0));
		gui_set_text_color(gui_color(255, 255, 255));
		}
#else
	if(((pin_down.x < 51) && (pin_down.x > 11)) && ((pin_down.y < 141) && (pin_down.y > 111)))
	{
		gdi_image_draw_id(11, 111, IMG_SETTING_BRIGHTNESS_DECREASE_PRESSED);
		gdi_image_draw_id(189, 111, IMG_SETTING_BRIGHTNESS_INCREASE);
		gdi_draw_line(0,200,240,200,GDI_COLOR_HIGHLIGHT);
	}
	else if(((pin_down.x < 219) && (pin_down.x > 189)) && ((pin_down.y < 141) && (pin_down.y > 111)))
	{
		gdi_image_draw_id(11, 111, IMG_SETTING_BRIGHTNESS_DECREASE);
		gdi_image_draw_id(189, 111, IMG_SETTING_BRIGHTNESS_INCREASE_PRESSED);
		gdi_draw_line(0,200,240,200,GDI_COLOR_HIGHLIGHT);
	}
	else if(((pin_down.x < 240) && (pin_down.x > 0)) && ((pin_down.y < 240) && (pin_down.y > 200)))
	{
		gdi_image_draw_id(11, 111, IMG_SETTING_BRIGHTNESS_DECREASE);
		gdi_image_draw_id(189, 111, IMG_SETTING_BRIGHTNESS_INCREASE);
		gdi_draw_solid_rect(0,200,240,240,GDI_COLOR_HIGHLIGHT);
		gui_set_text_color(gui_color(245, 245, 245));
	}
	else 
	{
		gdi_image_draw_id(11, 111, IMG_SETTING_BRIGHTNESS_DECREASE);
		gdi_image_draw_id(189, 111, IMG_SETTING_BRIGHTNESS_INCREASE);
		gdi_draw_line(0,200,240,200,GDI_COLOR_HIGHLIGHT);
		gui_set_text_color(gui_color(54, 155, 165));
	}
#endif
		gui_set_font(&MMI_large_font); 
		gui_measure_string((UI_string_type)GetString(STR_GLOBAL_OK), &str_w, &str_h);
		layoutx = ((string_region - str_w) >> 1);
		#if (defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
		gui_move_text_cursor(layoutx, 198);
		#else
		gui_move_text_cursor(layoutx, 208);
		#endif
		gui_print_text((UI_string_type)GetString(STR_GLOBAL_OK));
	

	gdi_layer_pop_clip();
	gdi_layer_unlock_frame_buffer();
	gdi_layer_pop_and_restore_active();

	gdi_layer_blt_previous(
		0, 111,
		240,
		240);


}

static void mmi_phnset_display_brightness_up(mmi_pen_point_struct pos)
{
	S32 data;
	S32 layoutx;
	S32 str_w, str_h;
	UI_string_type current_value;
	S32 string_region;
#if (!defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)	
	S32 i,j,k,l,n,m = 1;
#endif
	MMI_BOOL in_area = MMI_FALSE;
#ifdef __MMI_WEARABLE_DEVICE_UI_ENHANCE__
	gui_watch_progress_bar_struct volume_bar;
#endif
	string_region = LCD_WIDTH;
		
	//gdi_image_draw_id(LCD_WIDTH>>1, 30, MAIN_MENU_ARROW_DN_BG_ICON);
	#if (defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
	if(((pin_down.x < 78) && (pin_down.x > 38)) && ((pin_down.y < 142) && (pin_down.y > 112)))
	{
		if(((pos.x < 78) && (pos.x > 38)) && ((pos.y < 142) && (pos.y > 112)))
	#else
	if(((pin_down.x < 51) && (pin_down.x > 11)) && ((pin_down.y < 141) && (pin_down.y > 111)))
	{
		if(((pos.x < 51) && (pos.x > 11)) && ((pos.y < 141) && (pos.y > 111)))
	#endif
		{
			if(g_phnset_gpio_cntx_p->bl_setting_level>1)
			{
				g_phnset_gpio_cntx_p->bl_setting_level--;
			}
			//in_area = MMI_TRUE;
		}
		in_area = MMI_TRUE;
	}
	#if (defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
	if(((pin_down.x < 209) && (pin_down.x > 177)) && ((pin_down.y < 142) && (pin_down.y > 112)))
	{
		if(((pos.x < 209) && (pos.x > 177)) && ((pos.y < 142) && (pos.y > 112)))
	#else
	if(((pin_down.x < 219) && (pin_down.x > 189)) && ((pin_down.y < 141) && (pin_down.y > 111)))
	{
		if(((pos.x < 219) && (pos.x > 189)) && ((pos.y < 141) && (pos.y > 111)))
	#endif
		{
			if(g_phnset_gpio_cntx_p->bl_setting_level<5)
			{
				g_phnset_gpio_cntx_p->bl_setting_level++;
			}
			//in_area = MMI_TRUE;
		}
		in_area = MMI_TRUE;
	}
	#if (defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
	if(((pin_down.x < 240) && (pin_down.x > 0)) && ((pin_down.y < 240) && (pin_down.y > 180)))
	{
		if(((pos.x < 240) && (pos.x > 0)) && ((pos.y < 240) && (pos.y > 180)))
	#else
	if(((pin_down.x < 240) && (pin_down.x > 0)) && ((pin_down.y < 240) && (pin_down.y > 200)))
	{
		if(((pos.x < 240) && (pos.x > 0)) && ((pos.y < 240) && (pos.y > 200)))
	#endif
		{
			ReadValueSlim(NVRAM_BYTE_BL_SETTING_LEVEL, &data, DS_BYTE);
		    if (data != g_phnset_gpio_cntx_p->bl_setting_level)
		    {
		        WriteValueSlim(NVRAM_BYTE_BL_SETTING_LEVEL, &(g_phnset_gpio_cntx_p->bl_setting_level), DS_BYTE);
		    }
			//mmi_frm_scrn_close_active_id();
			mmi_frm_group_close(GRP_ID_DISPLAY_BRIGHTNESS);
		}
		else
		{
			gdi_layer_push_and_set_active(swatch_dispaly_cell_info.cell_layer_handler);
			gdi_layer_lock_frame_buffer();
	#if (defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
			gdi_layer_push_and_set_clip(
		        0, 180,
		        240,
		        240);
	#else
			gdi_layer_push_and_set_clip(
		        0, 200,
		        240,
		        240);
	#endif
			gdi_layer_set_source_key(MMI_TRUE,GDI_COLOR_TRANSPARENT);
			gdi_layer_clear(GDI_COLOR_TRANSPARENT);


			//draw button
			#if (defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
			gdi_draw_solid_rect(0,180,240,240,gdi_act_color_from_rgb(255, 255, 150, 0));
			gui_set_text_color(gui_color(255, 255, 255));
			#else
			gdi_draw_line(0,200,240,200,GDI_COLOR_HIGHLIGHT);
			gui_set_text_color(gui_color(54, 155, 165));
			#endif
			gui_set_font(&MMI_large_font); 
			
			gui_measure_string((UI_string_type)GetString(STR_GLOBAL_OK), &str_w, &str_h);
			layoutx = ((string_region - str_w) >> 1);
			#if (defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
			gui_move_text_cursor(layoutx, 198);
			#else
			gui_move_text_cursor(layoutx, 208);
			#endif
			gui_print_text((UI_string_type)GetString(STR_GLOBAL_OK));

			gdi_layer_pop_clip();
		    gdi_layer_unlock_frame_buffer();
			gdi_layer_pop_and_restore_active();
			#if (defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
			gdi_layer_blt_previous(
		        0, 180,
		        240,
		        240);
			#else
			gdi_layer_blt_previous(
		        0, 200,
		        240,
		        240);
			#endif

		}
	}

	if(in_area == MMI_TRUE)
	{
		srv_gpio_setting_set_bl_level(g_phnset_gpio_cntx_p->bl_setting_level,MMI_FALSE);
#if (!defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)		
		n = g_phnset_gpio_cntx_p->bl_setting_level;
#endif		
		gdi_layer_push_and_set_active(swatch_dispaly_cell_info.cell_layer_handler);
		gdi_layer_lock_frame_buffer();

		gdi_layer_push_and_set_clip(
	        8, 59,
	        240,
	        141);
		gdi_layer_set_source_key(MMI_TRUE,GDI_COLOR_TRANSPARENT);
		gdi_layer_clear(GDI_COLOR_TRANSPARENT);
#if (defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
		wgui_watch_progress_bar_create(&volume_bar,24, 79, 5, g_phnset_gpio_cntx_p->bl_setting_level);
		wgui_watch_progress_bar_draw(volume_bar);
		gdi_image_draw_id(38, 112, IMG_SETTING_BRIGHTNESS_DECREASE);
		gdi_image_draw_id(177, 112, IMG_SETTING_BRIGHTNESS_INCREASE);
#else
		gdi_draw_solid_rect(8, 59, 231, 99, GDI_COLOR_BOLDER);
		for(i=11; i<231; i)
		{
			if(m <= n)
			{
				k = i + 39;
				for(j=i; j<k; j)
				{
					
					l = j + 3;
					gdi_draw_solid_rect(j, 62, l, 96, GDI_COLOR_HIGHLIGHT);
					gdi_draw_solid_rect(l, 62, l+1, 96, GDI_COLOR_BOLDER);
					j = j+4;
				}
				gdi_draw_solid_rect(k, 62, k+5, 96, GDI_COLOR_BOLDER);
				
				m++;
			}
			else if(m > n && m <= 5)
			{
				k = i + 39;
				for(j=i; j<k; j)
				{
					
					l = j + 3;
					gdi_draw_solid_rect(j, 62, l, 96, GDI_COLOR_NORMAL);
					gdi_draw_solid_rect(l, 62, l+1, 96, GDI_COLOR_BOLDER);
					j = j+4;
				}
				gdi_draw_solid_rect(k, 62, k+5, 96, GDI_COLOR_BOLDER);
				m++;
			}
			i = i+44;
		}

		gdi_image_draw_id(11, 111, IMG_SETTING_BRIGHTNESS_DECREASE);
		gdi_image_draw_id(189, 111, IMG_SETTING_BRIGHTNESS_INCREASE);
#endif
		gdi_layer_pop_clip();
	    gdi_layer_unlock_frame_buffer();
		gdi_layer_pop_and_restore_active();
		gdi_layer_blt_previous(
	        0, 59,
	        240,
	        141);


	}
	
}

static void ExitBrightnessScreen(void)
{
     /*----------------------------------------------------------------*/
     /* Local Variables                                                */
     /*----------------------------------------------------------------*/

     /*----------------------------------------------------------------*/
     /* Code Body                                                      */
     /*----------------------------------------------------------------*/
 	
	 ReadValueSlim(NVRAM_BYTE_BL_SETTING_LEVEL, &(g_phnset_gpio_cntx_p->bl_setting_level), DS_BYTE);
	 srv_backlight_set_real_level(SRV_BACKLIGHT_TYPE_MAINLCD, g_phnset_gpio_cntx_p->bl_setting_level);
	// 	srv_gpio_setting_set_bl_level(g_phnset_gpio_cntx_p->bl_setting_level,MMI_FALSE);
	if (swatch_dispaly_cell_info.cell_layer_handler != GDI_LAYER_EMPTY_HANDLE)
	{
		gdi_layer_free(swatch_dispaly_cell_info.cell_layer_handler);
		swatch_dispaly_cell_info.cell_layer_handler = GDI_LAYER_EMPTY_HANDLE;
	}
	mmi_frm_group_close(GRP_ID_DISPLAY_BRIGHTNESS);
}
void LSK_Brightness_Callback(void)
{
	S32 data = 0;
	ReadValueSlim(NVRAM_BYTE_BL_SETTING_LEVEL, &data, DS_BYTE);
	if (data != g_phnset_gpio_cntx_p->bl_setting_level)
	{
	    WriteValueSlim(NVRAM_BYTE_BL_SETTING_LEVEL, &(g_phnset_gpio_cntx_p->bl_setting_level), DS_BYTE);
	}
	mmi_frm_group_close(GRP_ID_DISPLAY_BRIGHTNESS);
}
static void mmi_phnset_display_brightness_increase(void)
{
	srv_backlight_set_real_level(SRV_BACKLIGHT_TYPE_MAINLCD, g_phnset_gpio_cntx_p->bl_setting_level);
}
static void mmi_phnset_display_brightness_decrease(void)
{
	srv_backlight_set_real_level(SRV_BACKLIGHT_TYPE_MAINLCD, g_phnset_gpio_cntx_p->bl_setting_level);
}

static mmi_ret mmi_entry_display_brightness_screen_proc(mmi_event_struct *evt)
{
	 switch(evt->evt_id)
    {

		case EVT_ID_TOUCHSCREEN_MOVE_RIGHT:
			{	
				ReadValueSlim(NVRAM_BYTE_BL_SETTING_LEVEL, &(g_phnset_gpio_cntx_p->bl_setting_level), DS_BYTE);
				srv_gpio_setting_set_bl_level(g_phnset_gpio_cntx_p->bl_setting_level,MMI_FALSE);
			}
			break;
    }
    return MMI_RET_OK;    
}

static void mmi_phnset_display_brightness_menu(void)
{
#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
	#ifdef __MMI_WEARABLE_DEVICE_UI_ENHANCE__
/* under construction !*/
	#endif
#if (!defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
/* under construction !*/
#endif
#endif
	mmi_frm_group_create_ex(
        GRP_ID_DISPLAY_MENU,
        GRP_ID_DISPLAY_BRIGHTNESS,
        mmi_entry_display_brightness_screen_proc,
        NULL, 
        MMI_FRM_NODE_SMART_CLOSE_FLAG);
	if (!mmi_frm_scrn_enter(
			GRP_ID_DISPLAY_BRIGHTNESS, 
			SRC_ID_DISPLAY_BRIGHTNESS, 
			ExitBrightnessScreen, 
			(FuncPtr)mmi_phnset_display_brightness_menu, 
			MMI_FRM_FULL_SCRN))
	{
		return;
	}
	ShowCategory105Screen_ext(
							  0,
							  0,
							  STR_GLOBAL_OK,
							  0,
							  0,
							  0,
							  5,
							  1,
							  &g_phnset_gpio_cntx_p->bl_setting_level,
							  NULL);
	cat105_register_increase_bt_callback(KEY_EVENT_DOWN, mmi_phnset_display_brightness_increase);	
	cat105_register_decrease_bt_callback(KEY_EVENT_DOWN, mmi_phnset_display_brightness_decrease);
	SetLeftSoftkeyFunction(LSK_Brightness_Callback, KEY_EVENT_UP);
#if 0
#if (!defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
/* under construction !*/
#endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#if (defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#else
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
/* under construction !*/
/* under construction !*/
#if (defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
/* under construction !*/
/* under construction !*/
#else
/* under construction !*/
/* under construction !*/
#endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
	#if (defined  __MMI_WEARABLE_DEVICE_UI_ENHANCE__)
/* under construction !*/
	#else
/* under construction !*/
	#endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#if defined(__MMI_TOUCH_SCREEN__)	
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
#endif
}

#ifdef __MMI_GPIO_SUPPORT_BL_TIME_SETTING__
static void mmi_init_phnset_screen_time_out_menu(MMI_ID cui_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 item_num = SCREEN_TIME_OUT_NUM; 
    U8 i;
    mmi_menu_id *menu_id;
	U16 index;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    menu_id = (mmi_menu_id*)OslMalloc(item_num * sizeof(mmi_menu_id));
    for(i = 0; i < item_num; i++)
    {
        menu_id[i]=(mmi_menu_id)i;
    }
	//read data
	{
    	//ReadValueSlim(NVRAM_PHNSET_MAIN_MENU_STYLE, &data, DS_BYTE);
		if(g_phnset_gpio_cntx_p->bl_setting_hftime <= 5)
		{
			index = 0;
		}
		else if(g_phnset_gpio_cntx_p->bl_setting_hftime <= 10)
		{
			index = 1;
		}
		else if(g_phnset_gpio_cntx_p->bl_setting_hftime <= 15)
		{
			index = 2;
		}
		else if(g_phnset_gpio_cntx_p->bl_setting_hftime <= 30)
		{
			index = 3;
		}
		else
		{
			index = 4;
		}
    }
    cui_menu_set_currlist_title(cui_gid, (WCHAR*) GetString(STR_SCREEN_TIME_OUT), NULL);
    
    cui_menu_set_currlist(cui_gid, item_num, menu_id);
    
    cui_menu_set_currlist_flags(cui_gid, CUI_MENU_NORMAL_RADIO_BUTTON_LIST);

    if (!mmi_frm_is_in_backward_scenario())
	{
        cui_menu_set_currlist_highlighted_id(cui_gid, index);
	}

    for(i = 0; i < item_num; i++)
    {
        cui_menu_set_item_string(cui_gid, i, (WCHAR*)GetString(gScreenTimeoutList[i]));
    }

    OslMfree(menu_id); 

}

static mmi_ret mmi_phnset_screen_time_out_menu_proc(mmi_event_struct *param)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 	cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)param;
	S32 data;
	U16 index;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (menu_evt->evt_id)
    {
    case EVT_ID_CUI_MENU_LIST_ENTRY:
        mmi_init_phnset_screen_time_out_menu(menu_evt->sender_id);
        break;
		
    case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:
		index = ((cui_menu_event_struct*)menu_evt)->highlighted_menu_id;
		if(index == 0)
		{
			g_phnset_gpio_cntx_p->bl_setting_hftime = 5;
		}
		else if(index == 1)
		{
			g_phnset_gpio_cntx_p->bl_setting_hftime = 10;
		}
		else if(index == 2)
		{
			g_phnset_gpio_cntx_p->bl_setting_hftime = 15;
		}
		else if(index == 3)
		{
			g_phnset_gpio_cntx_p->bl_setting_hftime = 30;
		}
		else
		{
			g_phnset_gpio_cntx_p->bl_setting_hftime = 60;
		}

		ReadValueSlim(NVRAM_BYTE_BL_SETTING_HFTIME, &data, DS_SHORT);
	    if (data != g_phnset_gpio_cntx_p->bl_setting_hftime)
	    {
	        WriteValueSlim(NVRAM_BYTE_BL_SETTING_HFTIME, &(g_phnset_gpio_cntx_p->bl_setting_hftime), DS_SHORT);
	    }
	    srv_backlight_set_hf_time(SRV_BACKLIGHT_SET_TIMER_DEFAULT, g_phnset_gpio_cntx_p->bl_setting_hftime); 
		srv_backlight_turn_on(SRV_BACKLIGHT_SHORT_TIME);
		cui_menu_close(mmi_frm_group_get_active_id());
    	break;

    case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        cui_menu_close(mmi_frm_group_get_active_id());
        break;
        
    case EVT_ID_GROUP_DEINIT:
        if (menu_evt->user_data)
    	{
    	    OslMfree(menu_evt->user_data);
    	}
        break;
        
    default:
    	break;
    }
    return MMI_RET_OK;    
}

static void mmi_phnset_screen_time_out_menu(MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_appcreate_menucui_create(
        parent_gid,
        GRP_ID_DISPLAY_SCREEN_TIME_OUT,
        MENU_ID_SCREEN_TIME_OUT,
        mmi_phnset_screen_time_out_menu_proc);
}
#endif
#endif /*__MMI_BACKLIGHT_SUPPORT__*/

static void mmi_init_phnset_mainmenu_style_menu(MMI_ID cui_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 item_num = 2; 
    U8 i,j,data;
    mmi_menu_id *menu_id;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    menu_id = (mmi_menu_id*)OslMalloc(item_num * sizeof(mmi_menu_id));
    for(i = 0; i < item_num; i++)
    {
        menu_id[i]=(mmi_menu_id)i;
    }
    
    cui_menu_set_currlist_title(cui_gid, (WCHAR*) GetString(STR_MAIN_MENU_STYLE), NULL);
    
    cui_menu_set_currlist(cui_gid, item_num, menu_id);
    
    cui_menu_set_currlist_flags(cui_gid, CUI_MENU_NORMAL_RADIO_BUTTON_LIST);

	ReadValueSlim(NVRAM_PHNSET_MAIN_MENU_STYLE, &data, DS_BYTE);
	if(data == 0x00)
	{
		j = 0;
	}
	else
	{
		j = 1;
	}

    if (!mmi_frm_is_in_backward_scenario())
	{
        cui_menu_set_currlist_highlighted_id(cui_gid, j);
	}

    for(i = 0; i < item_num; i++)
    {
        cui_menu_set_item_string(cui_gid, i, (WCHAR*)GetString(gMainMenuStyleList[i]));
    }

    OslMfree(menu_id); 

}

static mmi_ret mmi_phnset_mainmenu_style_menu_proc(mmi_event_struct *param)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 	cui_menu_event_struct *menu_evt = (cui_menu_event_struct*)param;
	U8 data;
	U8 index;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (menu_evt->evt_id)
    {
    case EVT_ID_CUI_MENU_LIST_ENTRY:
        mmi_init_phnset_mainmenu_style_menu(menu_evt->sender_id);
        break;
		
    case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:
		
		index = ((cui_menu_event_struct*)menu_evt)->highlighted_menu_id;
		ReadValueSlim(NVRAM_PHNSET_MAIN_MENU_STYLE, &data, DS_BYTE);
	    if (data != index)
	    {
	        WriteValueSlim(NVRAM_PHNSET_MAIN_MENU_STYLE, &index, DS_BYTE);
	    }
 		cui_menu_close(mmi_frm_group_get_active_id());
		mmi_idle_display();
    	break;

    case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        cui_menu_close(mmi_frm_group_get_active_id());
        break;
        
    case EVT_ID_GROUP_DEINIT:
        if (menu_evt->user_data)
    	{
    	    OslMfree(menu_evt->user_data);
    	}
        break;
        
    default:
    	break;
    }
    return MMI_RET_OK;    
}

static void mmi_phnset_display_mainmenu_style_menu(MMI_ID parent_gid)
{
	 mmi_phnset_appcreate_menucui_create(
        parent_gid,
        GRP_ID_DISPLAY_MAINMENU_STYLE,
        MENU_ID_MAIN_MENU_STYLE,
        mmi_phnset_mainmenu_style_menu_proc);
}

enum {
	INDEX_START = 0x00,
#if defined(__MMI_SMART_WATCH_MAINMENU_ONE__) && defined(__MMI_SMART_WATCH_MAINMENU_FOUR__)
	INDEX_ICON,
#endif	
#ifdef __MMI_BACKLIGHT_SUPPORT__
	INDEX_BACKLIGHT,
#ifdef __MMI_GPIO_SUPPORT_BL_TIME_SETTING__
	INDEX_BLTIME,
#endif
#endif
	INDEX_LAST
}E_PHNSETUP_INDEX;

void mmi_display_tap_callback(mmi_tap_type_enum tap_type, S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
   // if (tap_type == ENUM_TAP_ON_HIGHLIGHTED_ITEM)
    {
    	index++;
#if defined(__MMI_SMART_WATCH_MAINMENU_ONE__) && defined(__MMI_SMART_WATCH_MAINMENU_FOUR__)
    	if(index == INDEX_ICON)
    	{
    		mmi_phnset_display_mainmenu_style_menu(GRP_ID_DISPLAY_MENU);
    		
    	}
#endif
#ifdef __MMI_BACKLIGHT_SUPPORT__
		if(index == INDEX_BACKLIGHT)
    	{
    		mmi_phnset_display_brightness_menu();
    		
    	}
#ifdef __MMI_GPIO_SUPPORT_BL_TIME_SETTING__
		else if(index == INDEX_BLTIME)
    	{
    		mmi_phnset_screen_time_out_menu(GRP_ID_DISPLAY_MENU);
    	}
#endif
#endif /*__MMI_BACKLIGHT_SUPPORT__*/
    }
}

static S32 DisplayUpdateItemData(S32 start_index, gui_iconlist_menu_item *menu_data, S32 num_items)
{
	U8 i,j,index;
	CHAR* hftime;
	U8 data;
	U8 set;
	
	start_index++;
	for (i = 0; i < num_items; i++)
    {
    	index = start_index + i;
#if defined(__MMI_SMART_WATCH_MAINMENU_ONE__) && defined(__MMI_SMART_WATCH_MAINMENU_FOUR__)
		if(index == INDEX_ICON)
		{
			ReadValueSlim(NVRAM_PHNSET_MAIN_MENU_STYLE, &data, DS_BYTE);
			if(data == 0x00)
			{
				j = 0;
			}
			else
			{
				j = 1;
			}
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_MAIN_MENU_STYLE));
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(gMainMenuStyleList[j]));
		}
#endif
#ifdef __MMI_BACKLIGHT_SUPPORT__
		else if(index == INDEX_BACKLIGHT)
		{
			if(g_phnset_gpio_cntx_p->bl_setting_level > 5)
			{
				g_phnset_gpio_cntx_p->bl_setting_level = 5;
			}
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_BACK_LIGHT_BRIGHNESS));
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1], GetString(gBrighnessList[g_phnset_gpio_cntx_p->bl_setting_level-1]));
		}
#ifdef __MMI_GPIO_SUPPORT_BL_TIME_SETTING__	
		else if(index == INDEX_BLTIME)
		{
			if(g_phnset_gpio_cntx_p->bl_setting_hftime <= 5)
			{
				set = 0;
			}
			else if(g_phnset_gpio_cntx_p->bl_setting_hftime <= 10)
			{
				set = 1;
			}
			else if(g_phnset_gpio_cntx_p->bl_setting_hftime <= 15)
			{
				set = 2;
			}
			else if(g_phnset_gpio_cntx_p->bl_setting_hftime <= 30)
			{
				set = 3;
			}
			else 
			{
				set = 4;
			}

			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[0], GetString(STR_SCREEN_TIME_OUT));
			mmi_ucs2cpy((CHAR*)menu_data[i].item_list[1],  GetString(gScreenTimeoutList[set]));
		}
#endif
#endif /*__MMI_BACKLIGHT_SUPPORT__*/
	}
	return num_items;
}


static void mmi_exit_display_screen(void)
{

	mmi_frm_group_close(GRP_ID_DISPLAY_MENU);
}

static mmi_ret mmi_entry_display_screen_proc(mmi_event_struct *param)
{
    return MMI_RET_OK;    
}
static void EntryDisplayScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	U8 *gui_buffer = NULL;
	S32 highlighted_item = 0;
	U8 item_num;
#ifdef __MMI_BACKLIGHT_SUPPORT__
#ifdef __MMI_GPIO_SUPPORT_BL_TIME_SETTING__
	item_num = 2;
#else
	item_num = 1;
#endif
#else /*__MMI_BACKLIGHT_SUPPORT__*/
	item_num = 0;
#endif
#if defined(__MMI_SMART_WATCH_MAINMENU_ONE__) && defined(__MMI_SMART_WATCH_MAINMENU_FOUR__)
	item_num++;
#endif
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_group_create_ex(
        GRP_ID_ROOT,
        GRP_ID_DISPLAY_MENU,
        mmi_entry_display_screen_proc,
        NULL, 
        MMI_FRM_NODE_SMART_CLOSE_FLAG);
    
	if (!mmi_frm_scrn_enter(
		GRP_ID_DISPLAY_MENU,
		SRC_ID_DISPLAY_SCREEN,
		NULL,
		EntryDisplayScr,
		MMI_FRM_UNKNOW_SCRN))
	{
		return;
	}

	gui_buffer = mmi_frm_scrn_get_active_gui_buf();
	
	RegisterHighlightHandler(mmi_phnset_highlight_hdlr);
	
	if (gui_buffer != NULL)
	{
		highlighted_item = g_phnset_cntx_p->curHightlightItem;
	}
	
	highlighted_item = g_phnset_cntx_p->curHightlightItem;
	
	wgui_swatch_two_line_menu_list_screen(
		(PU8)GetString(STR_BACK_LIGHT_DISP),
		NULL,
		STR_GLOBAL_OK,
		NULL,
		STR_GLOBAL_BACK,
		item_num,
		DisplayUpdateItemData,
		highlighted_item,
		gui_buffer);
	
	SetRightSoftkeyFunction(mmi_frm_scrn_close_active_id, KEY_EVENT_UP);

#if defined(__MMI_FTE_SUPPORT__) && defined(__MMI_TOUCH_SCREEN__)
	wgui_register_tap_callback(mmi_display_tap_callback);
#endif  
}

void HighlightDisplayScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* 1 Change left soft key icon and label */
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    /* 2 Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);

    /* 3 Register function for left soft key */
    SetLeftSoftkeyFunction(EntryDisplayScr, KEY_EVENT_UP);
    SetCenterSoftkeyFunction(EntryDisplayScr, KEY_EVENT_UP);
    /* 4 Register function for right soft key */
    //SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
}


#else
/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetScr
 * DESCRIPTION
 *  This function is Entry function for Phonesetup
 * PARAMETERS
 *  void       
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID main_menu_cui_id;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_frm_group_create_ex(
        GRP_ID_ROOT,
        GRP_ID_PHNSET_MENU,
        mmi_phnset_menu_handler,
        NULL, 
        MMI_FRM_NODE_SMART_CLOSE_FLAG);
    
    
    main_menu_cui_id = cui_menu_create(
        GRP_ID_PHNSET_MENU,
        CUI_MENU_SRC_TYPE_RESOURCE,
        CUI_MENU_TYPE_APPMAIN,
        MENU9102_INITIAL_SETUP,
        MMI_FALSE,
        NULL);

    
    cui_menu_set_default_title_image_by_id(main_menu_cui_id, MAIN_MENU_TITLE_SETTINGS_ICON);
    cui_menu_run(main_menu_cui_id);
    
}
#endif
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif

#ifdef __MMI_NITZ__
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_set_nitz_text_hint
 * DESCRIPTION
 *  Set hint for nitz
 * PARAMETERS
 *  
 * RETURNS
 *  static void
 *****************************************************************************/
static void mmi_phnset_set_nitz_text_hint(MMI_ID menucui_id)
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    cui_menu_set_item_hint(
        menucui_id,
        MENU_ID_NITZ_APP,
        (WCHAR*)GetString(mmi_get_update_status_string_from_nitz()));
		#if 0
/* under construction !*/
		#endif
}

#endif /* __MMI_NITZ__ */

#if (0) //defined(__MMI_TOUCH_SCREEN__) && !defined(__MMI_NO_HANDWRITING__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #if defined (__MMI_IME_V3__)
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* #if defined(__MMI_TOUCH_SCREEN__) && !defined(__MMI_NO_HANDWRITING__) */ 
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTINGS_RODATA" , code = "DYNAMIC_CODE_SETTINGS_ROCODE"
#endif
#ifdef __MMI_SET_DEF_ENCODING_TYPE__
/*****************************************************************************
 * FUNCTION
 *  PhnsetDefEncodingSelectHandler
 * DESCRIPTION
 *  This function is LSK handler for Phonesetup->Default Encoding Type -> X
 *  Follow functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetDefEncodingSelectHandler(U8 highlight_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_chset_enum chset_list[CHSET_TOTAL];
    mmi_chset_enum default_chset;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_chset_get_chset_list_by_language(chset_list, &default_chset);
    srv_setting_set_encoding_type(chset_list[highlight_id]);

    #ifdef __MMI_AUDIO_PLAYER__
        mmi_audply_encoding_type_change_callback();
    #endif

    #ifdef __MMI_MEDIA_PLAYER__
    	mmi_medply_encoding_type_change_callback();
	#endif

    mmi_popup_display_simple_ext(STR_GLOBAL_DONE, MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);
    mmi_frm_group_close(GRP_ID_PHNSET_DEF_ENCODING_TYPE);
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetDefEncoding
 * DESCRIPTION
 *  This function is Entry function for Phonesetup-> Default encoding type
 *  Following functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
static void EntryPhnsetDefEncoding(MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
        mmi_phnset_appcreate_menucui_create(
        parent_gid,
        GRP_ID_PHNSET_DEF_ENCODING_TYPE,
        MENU_SETTING_DEF_ENCODING_TYPE,
        mmi_phnset_encoding_menu_proc);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_init_encoding_menu
 * DESCRIPTION
 *  Init the prefer encoding menu
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_init_encoding_menu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    phnset_radio_button_menu_data_struct radio_button_menu;
    U16 nStrItemList[MAX_SUB_MENUS];
    mmi_chset_enum chset_list[CHSET_TOTAL];
    mmi_chset_enum default_chset;    
    U8 nNumofItem;
    U8 highlight_item = 0;
    U8 i;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    nNumofItem = mmi_chset_get_chset_list_by_language(chset_list, &default_chset);
    for (i = 0; i < nNumofItem; i++)
    {
        if (srv_setting_get_encoding_type()== chset_list[i])
        {
            highlight_item = i;
        }
        nStrItemList[i] = mmi_chset_get_chset_string(chset_list[i]);
    }

    radio_button_menu.group_id = GRP_ID_PHNSET_DEF_ENCODING_TYPE;
    radio_button_menu.menu_title_str_id = STR_DEF_ENCODING_TYPE_TITLE;
    radio_button_menu.menu_icon_id = MAIN_MENU_TITLE_SETTINGS_ICON;
    radio_button_menu.menu_item_num = nNumofItem;
    radio_button_menu.menu_item_str_list = NULL;
    radio_button_menu.menu_item_str_id_list = nStrItemList;
    radio_button_menu.highlighted_item_idx = highlight_item;

    mmi_phnset_init_radio_button_menu(&radio_button_menu);
}



/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_encoding_menu_proc
 * DESCRIPTION
 *  Proc function for prefer encoding setup menu 
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_encoding_menu_proc(mmi_event_struct *param)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (param->evt_id)
    {
    case EVT_ID_CUI_MENU_LIST_ENTRY:
        mmi_phnset_init_encoding_menu();
        break;
    case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:
        PhnsetDefEncodingSelectHandler(((cui_menu_event_struct*)param)->highlighted_menu_id);
    	break;

    case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        cui_menu_close(mmi_frm_group_get_active_id());
        break;
        
    case EVT_ID_GROUP_DEINIT:
        if (param->user_data)
    	{
    	    OslMfree(param->user_data);
    	}
        break;
        
    default:
    	break;
    }
    return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_set_encoding_menu_hint
 * DESCRIPTION
 *  Set hint for encoding menu 
 * PARAMETERS
 *  menucui_id
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_set_encoding_menu_hint(MMI_ID menucui_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    CHAR* hintStr;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    hintStr = (CHAR*) GetString(mmi_chset_get_chset_string(srv_setting_get_encoding_type()));
    cui_menu_set_item_hint(
        menucui_id,
        MENU_SETTING_DEF_ENCODING_TYPE,
        (WCHAR*)hintStr);    
}

#endif /* __MMI_SET_DEF_ENCODING_TYPE__ */ 
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif
/*****************************************************************************
 * FUNCTION
 *  PhnsetGetDefEncodingType
 * DESCRIPTION
 *  This function is export function for applications to query the current encoding type setting
 *  Follow functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
U8 PhnsetGetDefEncodingType(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return g_chset_text_encoding; 

}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetLang
 * DESCRIPTION
 *  This function is Entry function for Phonesetup->IdleScreenDisplay
 *  Following functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetLang(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_entry_set_language(GRP_ID_ROOT);
}

#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTINGS_RODATA" , code = "DYNAMIC_CODE_SETTINGS_ROCODE"
#endif
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_entry_set_language
 * DESCRIPTION
 *  Entry function for set language menu 
 * PARAMETERS
 *  
 * RETURNS
 *  static void
 *****************************************************************************/
static void mmi_phnset_entry_set_language(MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_appcreate_menucui_create(
        parent_gid,
        GRP_ID_PHNSET_LANGUAGE,
        MENU_SETTING_LANGUAGE,
        mmi_phnset_language_menu_proc);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetLangLSKHandler
 * DESCRIPTION
 *  This function is left softkey handling function
 *  for Phonesetup->Language
 *  Functionality: Save the setting menu style
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
static void PhnsetLangLSKHandler(void)
{
#ifndef __MMI_VECTOR_FONT_MEMORY_CARD_SUPPORT__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 data;
    S32 LangIdx = g_phnset_cntx_p->curHightlightItem;
    BOOL isAutoLangSet = MMI_FALSE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_AUTO_LANG_EN__
    if (g_phnset_cntx_p->curHightlightItem == 0)    /* Auto Language selected */
    {
        LangIdx = 0;
        isAutoLangSet = MMI_TRUE;
    }
    else
    {
        LangIdx -= 1;
    }
#endif /* __MMI_AUTO_LANG_EN__ */ 

    data = srv_setting_get_language();

   /************************************************************************/
    /* Robin 1129, Add auto language selection                        */
   /************************************************************************/
    /* if( (LangIdx != (S32) gCurrLangIndex) *** Different Language        */
    /*   || (data != 0xFF && isAutoLangSet == MMI_TRUE)  *** Auto Lang Set  */
    /*   || (data == 0xFF && isAutoLangSet == MMI_FALSE) *** Auto Lang UnSet */
    /*   )                                                   */
   /************************************************************************/
    if ((LangIdx != (S32) gCurrLangIndex)
        || (data != 0xFF && isAutoLangSet == MMI_TRUE) || (data == 0xFF && isAutoLangSet == MMI_FALSE))
    {
        if (isAutoLangSet == MMI_TRUE)
        {
        #ifdef __MMI_AUTO_LANG_EN__
            mmi_setting_set_language(AUTO_LANGUAGE_IDX);
        #endif /* __MMI_AUTO_LANG_EN__ */ 
        }
        else
        {
            mmi_setting_set_language(LangIdx);
        }
    }

#else
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 langSSC[SSC_SIZE];              
    U8 *langSSC_sel ;

    S32 LangIdx ;
    U8 langName[20];
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    strncpy(langName, (PU8)g_phnset_cntx_p->ppLang[g_phnset_cntx_p->curHightlightItem], 20);

    srv_setting_get_language(langSSC);
    mmi_li_get_ssc_by_langname(langName, (U8**)&langSSC_sel);
    LangIdx = GetLanguageIndex(langSSC_sel);

   /************************************************************************/
    /* Robin 1129, Add auto language selection                        */
   /************************************************************************/
    /* if( (LangIdx != (S32) gCurrLangIndex) *** Different Language        */
    /*   || (data != 0xFF && isAutoLangSet == MMI_TRUE)  *** Auto Lang Set  */
    /*   || (data == 0xFF && isAutoLangSet == MMI_FALSE) *** Auto Lang UnSet */
    /*   )                                                   */
   /************************************************************************/
    if (strcmp((PS8)gLanguageArray[LangIdx].aLangSSC, langSSC) != 0)
    {
            mmi_setting_set_language(LangIdx);
    }
#endif
#ifndef __MMI_WEARABLE_DEVICE_SETTING__
    mmi_popup_display_simple_ext(STR_GLOBAL_DONE, MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);
#endif
    mmi_frm_group_close(GRP_ID_PHNSET_LANGUAGE);
}
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif

/* Only for temporaly used */
/* Should be removed */
#ifndef __MMI_VECTOR_FONT_MEMORY_CARD_SUPPORT__
void SetCurrentLanguage(S8 nIndex)
{
    mmi_setting_set_language((U8)nIndex);
}
#else
void SetCurrentLanguage(U8* LangSSC)
{
    mmi_setting_set_language((U8)mmi_lang_support(LangSSC));
}
#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_setting_set_language
 * DESCRIPTION
 *  Set system language by index of gLanguageArray 
 * PARAMETERS
 *  language_idx    :   [IN] index of language in gLanguageArray
 * RETURNS
 *  MMI_FALSE : system do not support this language
 *  MMI_TRUE  : the language is set successfully
 *****************************************************************************/
MMI_BOOL mmi_setting_set_language(U8 language_idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    #ifdef __MMI_AUTO_LANG_EN__
    U16 autoLangIdx;
        #endif /* __MMI_AUTO_LANG_EN__ */ 
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_VECTOR_FONT_MEMORY_CARD_SUPPORT__ 
    srv_setting_set_language(gLanguageArray[language_idx].aLangSSC);
#else
    srv_setting_set_language(language_idx);
#endif

// TODO: implement notification receiver
    #ifdef __MMI_VUI_SHELL_MSG_VIEWER__
        vadp_shell_mv_refresh_panel();
    #endif

    if (mmi_idle_is_active())
    {
        mmi_idle_display();
    }
// TODO: implement notification receiver        
    
    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_get_language_idx
 * DESCRIPTION
 *  This function is to read language setting from nvram called by 
 *  Functionality:
 * PARAMETERS
 *  void           
 * RETURNS
 *  U8
 *****************************************************************************/
U8 mmi_phnset_get_language_idx(void)
{
#ifndef __MMI_VECTOR_FONT_MEMORY_CARD_SUPPORT__
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 data = srv_setting_get_language();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if (data == 0xFF)
    {
    #ifdef __MMI_AUTO_LANG_EN__
        /* If read nvram before SIM LP comming, treat as unspecified language */
        /* PhonsetGetAugoLanIdx will return default language index */
        data = srv_setting_get_auto_language_id();
    #else /* __MMI_AUTO_LANG_EN__ */ 
		data = 0;
	#endif /* __MMI_AUTO_LANG_EN__ */
	}
	if (data == 0xFF)
	{
		return 0;
	}

	return data;
#else

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 langSSC[SSC_SIZE];              
    U8 idx;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    srv_setting_get_language(langSSC);
    idx = (U8)GetLanguageIndex(langSSC);

    return idx;
#endif
}
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTINGS_RODATA" , code = "DYNAMIC_CODE_SETTINGS_ROCODE"
#endif


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_init_language_menu
 * DESCRIPTION
 *  Init the language menu
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_init_language_menu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    phnset_radio_button_menu_data_struct radio_button_menu;
    U8 nNumofItem;
    U8 hiliteItem = 0;
    U8 i;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    nNumofItem = (S32) GetLanguages(&(g_phnset_cntx_p->ppLang));

#ifdef __MMI_AUTO_LANG_EN__
    {
        U8 data = srv_setting_get_language();
        if (data == 0xFF)   /* Auto Language set */
        {
            hiliteItem = 0;
        }
        else
        {
            hiliteItem += 1;
        }
    }
    subMenuDataPtrs[0] = (PU8) GetString(STR_GLOBAL_AUTOMATIC);
    for (i = 0; i < nNumofItem; i++)
    {
        subMenuDataPtrs[i + 1] = g_phnset_cntx_p->ppLang[i];
    }
    nNumofItem += 1;
#else /* __MMI_AUTO_LANG_EN__ */ 
    for (i = 0; i < nNumofItem; i++)
    {
        subMenuDataPtrs[i] = g_phnset_cntx_p->ppLang[i];

        if (strcmp((PS8)g_phnset_cntx_p->ppLang[i], (PS8)gLanguageArray[gCurrLangIndex].aName) == 0)
        {
               hiliteItem = i;
        }
    }
#endif /* __MMI_AUTO_LANG_EN__ */ 

    radio_button_menu.group_id = GRP_ID_PHNSET_LANGUAGE;
    radio_button_menu.menu_title_str_id = STR_MENU_LANGUAGE;
    radio_button_menu.menu_icon_id = MAIN_MENU_TITLE_SETTINGS_ICON;
    radio_button_menu.menu_item_num = nNumofItem;
    radio_button_menu.menu_item_str_list = subMenuDataPtrs;
    radio_button_menu.menu_item_str_id_list = NULL;
    radio_button_menu.highlighted_item_idx = hiliteItem;

    mmi_phnset_init_radio_button_menu(&radio_button_menu);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_language_menu_proc
 * DESCRIPTION
 *  Proc function for language setting menu 
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  static mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_language_menu_proc(mmi_event_struct *param)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (param->evt_id)
    {
    case EVT_ID_CUI_MENU_LIST_ENTRY:
        mmi_phnset_init_language_menu();
        break;
    case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:
        g_phnset_cntx_p->curHightlightItem = (S32)((cui_menu_event_struct*)param)->highlighted_menu_id;
        PhnsetLangLSKHandler();
    	break;

    case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        cui_menu_close(mmi_frm_group_get_active_id());
        break;
        
    case EVT_ID_GROUP_DEINIT:
        if (param->user_data)
    	{
    	    OslMfree(param->user_data);
    	}
        break;
        
    default:
    	break;
    }
    return MMI_RET_OK;    
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_set_language_menu_hint
 * DESCRIPTION
 *  Set hint for language setting menu 
 * PARAMETERS
 *  
 * RETURNS
 *  static void
 *****************************************************************************/
static void mmi_phnset_set_language_menu_hint(MMI_ID menucui_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    CHAR* hint_str;
#ifndef __MMI_VECTOR_FONT_MEMORY_CARD_SUPPORT__
    U8 data;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    data = srv_setting_get_language();
#ifdef __MMI_AUTO_LANG_EN__
    if (data == 0xFF)   /* Auto Language Selected */
    {
        hint_str = (CHAR*)GetString(STR_GLOBAL_AUTOMATIC);
    }
    else
#endif /* __MMI_AUTO_LANG_EN__ */ 
    {
        hint_str = (CHAR*)gLanguageArray[data].aName;
    }
#else
    U8 langSSC[SSC_SIZE];
    U16 idx;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    srv_setting_get_language(langSSC);

    idx = GetLanguageIndex(langSSC);

    hint_str = (CHAR*)gLanguageArray[idx].aName;

#endif
    cui_menu_set_item_hint(
        menucui_id,
        MENU_SETTING_LANGUAGE,
        (WCHAR*)hint_str);
} 

#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif
/*****************************************************************************
 * FUNCTION
 *  ATSetLanguage
 * DESCRIPTION
 *  Set Language from AT command
 * PARAMETERS
 *  msg     [?]     Set language request
 * RETURNS
 *  void
 *****************************************************************************/
#ifndef __MMI_PHNSET_AT_DISABLE__
static void ATSetLanguage(void *msg, int mod_id)
{
#ifndef __SLIM_AT__    
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /* to see the value of language code */
    U8 data = 0;
    CHAR *ssc_sp;
    mmi_eq_set_language_req_ind_struct *msgInd;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    msgInd = (mmi_eq_set_language_req_ind_struct*) msg;

    switch (msgInd->lang_code)
    {
        case MMI_PS_AT_LANG_TW:
            ssc_sp = SSC_TCHINESE;  /* data = 1; */
            break;
        case MMI_PS_AT_LANG_ZH:
            ssc_sp = SSC_SCHINESE;  /* data = 2; */
            break;

        case MMI_PS_AT_LANG_DEFAULT:
        case MMI_PS_AT_LANG_EN:
        default:
            ssc_sp = SSC_ENGLISH;   /* data = 0; */
            break;
    }

    
        data = mmi_lang_support(ssc_sp);
            

    /* Language not support (out of boundary) */
    if (data >= gMaxDeployedLangs || data < 0)
    {
        SendLangChange2AT(0xFF, mod_id);
        return;
    }

    if (data != gCurrLangIndex)
    {
        mmi_setting_set_language(data);
    }

    SendLangChange2AT(data, mod_id);
#endif /* __SLIM_AT__ */
}

#ifndef __SLIM_AT__
/*****************************************************************************
 * FUNCTION
 *  SendLangChange2AT
 * DESCRIPTION
 *  Send to AT command when language change, for AT+CLAE
 * PARAMETERS
 *  code        [IN]        Language to be set
 * RETURNS
 *  void
 *****************************************************************************/
static void SendLangChange2AT(U8 code, int mod_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_eq_set_language_req_struct *msgReq;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    msgReq = (mmi_eq_set_language_req_struct*) OslConstructDataPtr(sizeof(mmi_eq_set_language_req_struct));

    /*
     * switch (code)
     * {
     * case 0: msgReq->lang_code = MMI_PS_AT_LANG_EN; break;
     * case 1: msgReq->lang_code = MMI_PS_AT_LANG_TW; break;
     * case 2: msgReq->lang_code = MMI_PS_AT_LANG_ZH; break;
     * default: msgReq->lang_code = MMI_PS_AT_LANG_EN; break;
     * }
     */

    if (code > gMaxDeployedLangs)
    {
        msgReq->lang_code = MMI_PS_AT_LANG_UNKWN;
    }
    else
    {
        if (mmi_lang_support(SSC_ENGLISH) >= 0)
        {
            msgReq->lang_code = MMI_PS_AT_LANG_EN;
        }
        else if (mmi_lang_support(SSC_TCHINESE) >= 0)
        {
            msgReq->lang_code = MMI_PS_AT_LANG_TW;
        }
        else if (mmi_lang_support(SSC_SCHINESE) >= 0)
        {
            msgReq->lang_code = MMI_PS_AT_LANG_ZH;
        }
        else
        {
            msgReq->lang_code = MMI_PS_AT_LANG_UNKWN;
        }
    }

    mmi_frm_send_ilm((oslModuleType)mod_id, PRT_MMI_EQ_SET_LANGUAGE_REQ, (oslParaType*)msgReq, NULL);
}
#endif /* __SLIM_AT__ */
#endif
#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #ifdef __OP01__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #endif /* __OP01__ */
/* under construction !*/
    #ifdef MMI_ON_HARDWARE_P
/* under construction !*/
    #else 
/* under construction !*/
    #endif 
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#ifndef __MMI_VECTOR_FONT_MEMORY_CARD_SUPPORT__
/* under construction !*/
#endif
/* under construction !*/
/* under construction !*/
#endif /* __MMI_AUTO_LANG_EN__ */ 


/* UART Setup functions */
#ifdef __GEMINI__
/* under construction !*/
#ifdef __MMI_AP_DCM_SETTING__
/* under construction !*/
#endif
/* under construction !*/
#ifndef __MMI_PHNSET_AT_DISABLE__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #ifdef __MMI_PHNSET_SLIM__
/* under construction !*/
/* under construction !*/
/* under construction !*/
                      #if (MMI_MAX_SIM_NUM >= 3)
/* under construction !*/
                      #if (MMI_MAX_SIM_NUM >= 4)
/* under construction !*/
                      #endif
                      #endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #else
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #if (MMI_MAX_SIM_NUM >= 3)
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #if (MMI_MAX_SIM_NUM >= 4)
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #endif /* (MMI_MAX_SIM_NUM >= 4) */
    #endif /* (MMI_MAX_SIM_NUM >= 3) */
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#ifdef __MMI_BACKGROUND_CALL__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __MMI_BACKGROUND_CALL__ */
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #if (MMI_MAX_SIM_NUM >= 3)
/* under construction !*/
    #if (MMI_MAX_SIM_NUM >= 4)
/* under construction !*/
    #endif
    #endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #if (MMI_MAX_SIM_NUM == 3)
/* under construction !*/
    #endif /* (MMI_MAX_SIM_NUM == 3) */
    #if (MMI_MAX_SIM_NUM == 4)
/* under construction !*/
    #endif /* (MMI_MAX_SIM_NUM == 4) */
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
	#if (GEMINI_PLUS >= 3)		  
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
	#if (GEMINI_PLUS >= 4)		  
/* under construction !*/
/* under construction !*/
/* under construction !*/
	#endif /* (GEMINI_PLUS >= 4) */
	#endif /* (GEMINI_PLUS >= 3) */ 		  
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #if (GEMINI_PLUS >= 3)            
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #if (GEMINI_PLUS >= 4)             
/* under construction !*/
/* under construction !*/
/* under construction !*/
    #endif /* (GEMINI_PLUS >= 4) */
    #endif /* (GEMINI_PLUS >= 3) */          
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#ifdef __MMI_BACKGROUND_CALL__
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* __MMI_BACKGROUND_CALL__ */
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif
#ifdef __MMI_AP_DCM_SETTING__
/* under construction !*/
#endif
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif	/* __GEMINI__ */
////xjdan need move to date and time
/*****************************************************************************
 * FUNCTION
 *  PhnsetReinitHomeCityIdx
 * DESCRIPTION
 *  This function is to rearrange home city global array and set home city highlight item
 *  Functionality:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetReinitHomeCityIdx(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
     /**
        * This Is Needed As Set Home City NVRAM Index Doesnt Change On Language Change
      * As The Global City Array Is Chnaged. 
      **/

     /**************************************************************/
    /*  Dont Chnage Order Of These Function Calls --Start-- Gurinder   ***** */
    #ifdef __MMI_TIMEZONE_SETTING__
    PhnsetReadNvmHomeCityIdxNStoreCityName();
    PhnsetReinitHomeCity();
    #endif 
    /*  Dont Chnage Order Of These Function Calls --End-- Gurinder     ***** */
     /**************************************************************/
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetFontSize
 * DESCRIPTION
 *  ...
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
U8 PhnsetGetFontSize(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    #ifdef __MMI_CHANGABLE_FONT__
    return g_phnset_cntx_p->font_size;
    #else
    return THEME_DEFAULT;
    #endif /* __MMI_CHANGABLE_FONT__ */
}

#ifdef __MMI_CHANGABLE_FONT__
/*****************************************************************************
 * FUNCTION
 *  PhnsetReadFontSize
 * DESCRIPTION
 *  ...
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetReadFontSize(void)   /* __USB_IN_NORMAL_MODE__ */
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    //S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    //ReadValue(NVRAM_BYTE_FONT_SIZE, &(g_phnset_cntx_p->font_size), DS_BYTE, &error);
	ReadValueSlim(NVRAM_BYTE_FONT_SIZE, &(g_phnset_cntx_p->font_size), DS_BYTE);
    if (g_phnset_cntx_p->font_size > LARGE)
    {
        g_phnset_cntx_p->font_size = THEME_DEFAULT;
    }

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetSetFontSize
 * DESCRIPTION
 *  Setting Font Size Enum
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetSetFontSize(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    //S16 error = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    //WriteValue(NVRAM_BYTE_FONT_SIZE, &(g_phnset_cntx_p->font_size), DS_BYTE, &error);
	WriteValueSlim(NVRAM_BYTE_FONT_SIZE, &(g_phnset_cntx_p->font_size), DS_BYTE);
    change_font_Theme();

	mmi_popup_display_simple_ext(STR_GLOBAL_DONE, MMI_EVENT_SUCCESS, GRP_ID_ROOT, NULL);
    mmi_frm_group_close(GRP_ID_PHNSET_FONT_SIZE);
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetFontSize
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetFontSize(MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
        mmi_phnset_appcreate_menucui_create(
        parent_gid,
        GRP_ID_PHNSET_FONT_SIZE,
        MENU_ID_PHNSET_FONT_SIZE,
        mmi_phnset_font_size_proc);
}

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_font_size_proc
 * DESCRIPTION
 *  Menu CUI proc function formmi_phnset_font_size 
 * PARAMETERS
 *  
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
mmi_ret mmi_phnset_font_size_proc(mmi_event_struct *param)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
 
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (param->evt_id)
    {
    case EVT_ID_CUI_MENU_LIST_ENTRY:
        mmi_phnset_init_font_size_list();
        break;
    case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:        
        g_phnset_cntx_p->font_size = (U8)((cui_menu_event_struct*)param)->highlighted_menu_id;
        PhnsetSetFontSize();
        break;

    case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        cui_menu_close(mmi_frm_group_get_active_id());
        break;
        
    case EVT_ID_GROUP_DEINIT:
        if (param->user_data)
    	{
    	    OslMfree(param->user_data);
    	}
        break;
    default:

    }
    return MMI_RET_OK;
}

 
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_init_font_size_list
 * DESCRIPTION
 *  Initialize font size setting list menu 
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_init_font_size_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
#ifndef __MMI_DIALLING_FONT__
    U8 nNumofItem = 4;
    U16 nStrItemList[4] = 
    {
        STR_ID_PHNSET_FONT_SIZE_THEME_DEFAULT, STR_ID_PHNSET_FONT_SIZE_SMALL, STR_GLOBAL_MEDIUM,
        STR_ID_PHNSET_FONT_SIZE_LARGE
    };
#else /* __MMI_DIALLING_FONT__ */ 
    U8 nNumofItem = 3;
    U16 nStrItemList[3] = 
    {
        STR_ID_PHNSET_FONT_SIZE_THEME_DEFAULT, STR_ID_PHNSET_FONT_SIZE_SMALL, STR_GLOBAL_MEDIUM
    };
#endif /* __MMI_DIALLING_FONT__ */      
    phnset_radio_button_menu_data_struct radio_button_menu;
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    radio_button_menu.group_id = GRP_ID_PHNSET_FONT_SIZE;
    radio_button_menu.menu_title_str_id = STR_ID_PHNSET_FONT_SIZE;
    radio_button_menu.menu_icon_id = MAIN_MENU_TITLE_SETTINGS_ICON;
    radio_button_menu.menu_item_num = nNumofItem;
    radio_button_menu.menu_item_str_list = NULL;
    radio_button_menu.menu_item_str_id_list = nStrItemList;
    radio_button_menu.highlighted_item_idx = g_phnset_cntx_p->font_size;

    mmi_phnset_init_radio_button_menu(&radio_button_menu);    
}
 

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_set_font_size_hint
 * DESCRIPTION
 *  Set hint for font size setting menu 
 * PARAMETERS
 *  
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_set_font_size_hint(MMI_ID menucui_id)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    CHAR* hint_str;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (g_phnset_cntx_p->font_size)
    {
        case THEME_DEFAULT:
            hint_str = (CHAR*)GetString(STR_ID_PHNSET_FONT_SIZE_THEME_DEFAULT);
            break;
        case SMALL:
            hint_str = (CHAR*)GetString(STR_ID_PHNSET_FONT_SIZE_SMALL);
            break;
        case MEDIUM:
            hint_str = (CHAR*)GetString(STR_GLOBAL_MEDIUM);
            break;
        case LARGE:
            hint_str = (CHAR*)GetString(STR_ID_PHNSET_FONT_SIZE_LARGE);            
            break;
    }
    cui_menu_set_item_hint(
        menucui_id,
        MENU_ID_PHNSET_FONT_SIZE,
        (WCHAR*)hint_str);
}
#endif /* __MMI_CHANGABLE_FONT__ */ 
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata = "DYNAMIC_CODE_SETTINGS_RODATA" , code = "DYNAMIC_CODE_SETTINGS_ROCODE"
#endif
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_menu_handler
 * DESCRIPTION
 *  proc function for GRP_ID_PHNSET_MENU
 * PARAMETERS
 *  param : [IN]    post event
 * RETURNS
 *  process result
 *****************************************************************************/
typedef mmi_ret (*mmi_phnset_menu_entry_hdlr) (cui_menu_event_struct *param, MMI_ID parent_gid);
mmi_phnset_menu_entry_hdlr phnset_menu_entry_array[]={
       mmi_phnset_main_menu_handler
#ifndef __MMI_MAINLCD_96X64__        
       ,mmi_phnset_disp_setup_sub_menu_handler
       ,mmi_phnset_time_and_date_sub_menu_handler
#endif       
       #ifdef __MMI_NITZ__
       ,mmi_nitz_phnset_menu_handler
       #endif
       #ifdef __NTPD_SUPPORT__
       ,mmi_ntp_phnset_menu_handler
       #endif
       #if defined(__MMI_MIXED_LANG_SUPPORT__) || defined(__MMI_PREFER_WRITING_LANG__) || defined(__MMI_PREFER_INPUT_METHOD__) || defined(__MMI_IME_PLUG_IN_SETTING__)
       ,mmi_imesettings_menu_handler
       #endif
       #if defined (__MMI_IME_V3__)
       ,mmi_imesettings_menu_handler_ext
       #endif
       #if defined(__MMI_FE_VECTOR_FONT_ON_FILE_SYSTEM__)
       ,mmi_font_mgr_menu_handler
       #endif
       #if defined(__MMI_GADGET_SUPPORT__)
       ,mmi_wgtmgr_menu_handler
       #endif
       #ifdef __MMI_THEMES_APPLICATION__
       ,mmi_theme_menu_handler
       #endif
       #ifndef __DISABLE_SHORTCUTS_MENU__
       ,mmi_shct_menu_handler
       #ifdef __MMI_DEDICATED_KEY_SHORTCUTS__
       ,mmi_shct_dedicated_key_menu_handler
       #endif
       #endif
	   #ifndef __MMI_MAINLCD_96X64__
       ,mmi_phnset_gpio_menu_handler
       #endif
       ,NULL
       
    };
static mmi_ret mmi_phnset_menu_handler(mmi_event_struct *param)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    cui_menu_event_struct *menucui_event;
    mmi_ret ret = MMI_RET_DONT_CARE;
    S8 i=0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Menu CUI event */
    if (cui_menu_is_menu_event(param->evt_id))
    {
        menucui_event = (cui_menu_event_struct*)param;
       while(1)
        {
         if(phnset_menu_entry_array[i])
         {
              ret=phnset_menu_entry_array[i](menucui_event, GRP_ID_PHNSET_MENU);
              if (ret != MMI_RET_DONT_CARE)
              {
               return ret;
              }
         }
         else
         {
            return ret;
         }
           i++;
        }
           
    }
	return MMI_RET_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_main_menu_handler
 * DESCRIPTION
 *  proc function for menu cui in GRP_ID_PHNSET_MENU
 * PARAMETERS
 *  param : [IN]    menu cui event
 * RETURNS
 *  process result
 *****************************************************************************/
static mmi_ret mmi_phnset_main_menu_handler(cui_menu_event_struct *param, MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (param->evt_id)
    {
    case EVT_ID_CUI_MENU_LIST_ENTRY:
        return mmi_phnset_main_menu_entry_handler(param, parent_gid);
#ifndef __MMI_PHNSET_SLIM__    

    case EVT_ID_CUI_MENU_ITEM_HILITE:
        return mmi_phnset_main_menu_highlight_handler(param, parent_gid);
#endif
    case EVT_ID_CUI_MENU_ITEM_SELECT:
    case EVT_ID_CUI_MENU_ITEM_TAP:
        return mmi_phnset_main_menu_select_handler(param, parent_gid);

    case EVT_ID_CUI_MENU_CLOSE_REQUEST:
        return mmi_phnset_main_menu_close_handler(param, parent_gid);
       
    default:
        break;            
    }
    return MMI_RET_DONT_CARE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_main_menu_entry_handler
 * DESCRIPTION
 *  Entry proc for phone setup menu
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_main_menu_entry_handler(cui_menu_event_struct *param, MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/  
    switch (param->parent_menu_id)
    {
    case MENU9102_INITIAL_SETUP:
        mmi_phnset_init_main_menu();
        return MMI_RET_OK;
    case MENU_ID_PHNSET_GPIO_SETTING:
        cui_menu_set_currlist_left_softkey_by_id(param->sender_id, STR_GLOBAL_OK);
        cui_menu_set_currlist_right_softkey_by_id(param->sender_id, STR_GLOBAL_BACK); 
        break;
    default:
        break;
    }
    return MMI_RET_DONT_CARE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_main_menu_highlight_handler
 * DESCRIPTION
 *  Highlight funciton for phone setup menu
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret 
 *****************************************************************************/
#ifndef __MMI_PHNSET_SLIM__    
static mmi_ret mmi_phnset_main_menu_highlight_handler(cui_menu_event_struct *param, MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    switch (param->highlighted_menu_id)
    {
    default:
        /* In order to set lsk back to OK */
        cui_menu_change_left_softkey_string_by_id(mmi_frm_group_get_active_id(), STR_GLOBAL_OK);
        break;
    }
    return MMI_RET_DONT_CARE;    
}
#endif

/*****************************************************************************
 * FUNCTION
 *  
 * DESCRIPTION
 *  Select funciton for phone setup menu 
 *  (divied into main menu select proc and sub menu select proc)
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret
 *****************************************************************************/
static mmi_ret mmi_phnset_main_menu_select_handler(cui_menu_event_struct *param, MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    switch (param->highlighted_menu_id)
    {
#ifdef __MMI_PHNSET_SCHEDULE_POWER_ON_OFF__
    case MENU_SETTING_SCHEDULE_POWER:
        EntrySpofApp(parent_gid);
        return MMI_RET_OK;        
#endif
       
#if defined(__MMI_TOUCH_SCREEN__) && !defined(__MMI_NO_HANDWRITING__) 
	#if !defined(__MMI_IME_V3__)
		case MENU_SETTING_HANDWRITING:
		EntryHandWritingSettingScr(parent_gid);
		return MMI_RET_OK;  
	#endif
#endif

    case MENU_SETTING_LANGUAGE:
        mmi_phnset_entry_set_language(parent_gid);
        return MMI_RET_OK;        
        
#ifdef __MMI_SET_DEF_ENCODING_TYPE__        
    case MENU_SETTING_DEF_ENCODING_TYPE:
        EntryPhnsetDefEncoding(parent_gid);
        return MMI_RET_OK;        
#endif /* __MMI_SET_DEF_ENCODING_TYPE__  */      
#if defined(__FLIGHT_MODE_SUPPORT__) && defined(__MMI_TELEPHONY_SUPPORT__)
    case MENU_SETTING_FLIGHT_MODE:
        mmi_flight_mode_entry(parent_gid);
        return MMI_RET_OK;        
#endif /* __FLIGHT_MODE_SUPPORT__ */

#ifdef __MMI_CHANGABLE_FONT__
    case MENU_ID_PHNSET_FONT_SIZE:
        EntryPhnsetFontSize(parent_gid);
        return MMI_RET_OK;        
#endif 

#ifdef __MMI_DUAL_SIM_MASTER__
#ifndef __MMI_PHNSET_AT_DISABLE__
/* under construction !*/
#ifdef __MTK_TARGET__
/* under construction !*/
#else 
/* under construction !*/
#endif         
/* under construction !*/
#endif        
#endif /* __MMI_DUAL_SIM_MASTER__ */
#ifdef __GENERAL_TTS__
    case MENU_ID_PHB_TTS_SETTING:
        mmi_tts_setting_entry_call_tts_setting(parent_gid);
        return MMI_RET_OK;

    case MENU_ID_SMS_TTS_SETTING:
        mmi_tts_setting_entry_sms_tts_setting(parent_gid);
        return MMI_RET_OK;        
#endif /* __GENERAL_TTS__ */

#ifdef MOTION_SENSOR_SUPPORT
    case MENU_ID_MOTION:/*cmm test*/
        mmi_phone_setting_motion_entry();
        break;
#endif

#ifdef __MMI_VUI_LAUNCHER_KEY__
	case MENU_ID_KEY_LAUNGCHER_WGTMGR:
		mmi_phnset_widget_manager_launch(parent_gid);
		return MMI_RET_OK;
#endif

#ifdef __MMI_VUI_LAUNCHER_KEY__
	case MENU_ID_FTE_LAUNGCHER_SHORTCUT:
		mmi_phnset_shortcut_mananger_launch(parent_gid);
		return MMI_RET_OK;
#endif

#ifdef __GENERAL_TTS__
	case MENU_ID_CUI_DIALER_TTS:
		cui_dialer_entry_tts_setting();
		return MMI_RET_OK;
#endif
    default:
        break;
    }
    return MMI_RET_DONT_CARE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_main_menu_close_handler
 * DESCRIPTION
 *  Close funciton for phone setup menu
 * PARAMETERS
 *  param   [IN]
 * RETURNS
 *  mmi_ret 
 *****************************************************************************/
static mmi_ret mmi_phnset_main_menu_close_handler(cui_menu_event_struct *param, MMI_ID parent_gid)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    
    cui_menu_close(mmi_frm_group_get_active_id());
    return MMI_RET_OK;    
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_init_main_menu
 * DESCRIPTION
 *  Init main menu of phone setup
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
extern void mmi_phnset_hide_menu_ext(MMI_ID main_menu_cui_id,const mmi_setting_hide_menu_struct* hide_menu_struct);
static void mmi_phnset_init_main_menu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
   // U16 i;
    MMI_ID main_menu_cui_id = mmi_frm_group_get_active_id();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Hide menu item */
#if 0  
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif

   mmi_phnset_hide_menu_ext(main_menu_cui_id,mmi_phnset_hide_menu);
#ifdef __MMI_TELEPHONY_SUPPORT__
    if (srv_cphs_is_service_available(SRV_CPHS_GROUP_VALUE_ADDED_SERVICES, SRV_CPHS_SERVICE_LANGUAGE, MMI_SIM1)
#ifdef __MMI_DUAL_SIM_MASTER__           
/* under construction !*/
#endif
        )
	{
	    cui_menu_set_item_hidden(main_menu_cui_id, MENU_SETTING_LANGUAGE, MMI_FALSE);
	}
    else
    {
	    cui_menu_set_item_hidden(main_menu_cui_id, MENU_SETTING_LANGUAGE, MMI_TRUE);
    }
#endif

#if defined(__MMI_TOUCH_SCREEN__) && !defined(__MMI_NO_HANDWRITING__) && !defined(__MMI_IME_V3__)
#if defined(__MMI_HANDWRITING_MEMORY_CARD_SUPPORT__)
	if(!mmi_imm_get_handwriting_setting())
	{
	    MMI_TRACE(MMI_FW_TRC_G5_IME, TRC_MMI_PHNSET_INIT_MAIN_MENU);
        cui_menu_set_item_hidden(main_menu_cui_id, MENU_SETTING_HANDWRITING, MMI_TRUE);
	}
#endif
#endif
#ifdef __MMI_BTD_BOX_UI_STYLE__
#ifdef __MMI_PREFER_INPUT_METHOD__
   cui_menu_set_item_hidden(main_menu_cui_id, MENU_SETTING_PREFERED_INPUT_METHOD, MMI_TRUE);
#endif/*__MMI_PREFER_INPUT_METHOD__*/
#endif/*__MMI_BTD_BOX_UI_STYLE__*/

    /* set menu list flags to numbered icon menu list at the first time enter*/
    cui_menu_set_currlist_flags(main_menu_cui_id, CUI_MENU_NORMAL_LIST_WITH_NUMBERED_ICONS);

    /* set hints of menu item */
    mmi_phnset_set_language_menu_hint(main_menu_cui_id);
#ifdef __MMI_PREFER_INPUT_METHOD__
	mmi_phnset_set_pref_input_mode_menu_hint(main_menu_cui_id);
#endif
#ifdef __MMI_SET_DEF_ENCODING_TYPE__ 
    mmi_phnset_set_encoding_menu_hint(main_menu_cui_id);
#endif
#ifdef __MMI_CHANGABLE_FONT__
    mmi_phnset_set_font_size_hint(main_menu_cui_id);
#endif
#ifdef __MMI_DUAL_SIM_MASTER__
#ifndef __MMI_PHNSET_AT_DISABLE__
/* under construction !*/
#endif
#endif
#ifndef __MMI_DUAL_SIM_MASTER__   
  #ifdef __MMI_TELEPHONY_SUPPORT__
    HintPhnsetFlightMode();
#endif
#endif
#ifdef __NTPD_SUPPORT__
	cui_menu_set_item_hidden(main_menu_cui_id, MENU_ID_NTP_APP, MMI_TRUE);
#endif
#ifdef __MMI_NITZ__
    mmi_phnset_set_nitz_text_hint(main_menu_cui_id);
#endif
    cui_menu_set_currlist_left_softkey_by_id(main_menu_cui_id, STR_GLOBAL_OK);
    cui_menu_set_currlist_right_softkey_by_id(main_menu_cui_id, STR_GLOBAL_BACK);    
#ifdef __MMI_VUI_LAUNCHER_KEY__
	if(vapp_keylauncher_get_widget_total_num() <= MIN_PHNSET_WIDGETS_NUM)
	{
		cui_menu_set_item_string_by_id(main_menu_cui_id, MENU_ID_KEY_LAUNGCHER_WGTMGR, STR_ID_KEY_LAUNGCHER_WGTMGR_ORDER_SETTINGS); 
	}
#endif

    /* cui_menu_refresh_currlist(main_menu_cui_id); */

}
#ifdef __MMI_AP_DCM_SETTING__
#pragma arm section rodata , code
#endif
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_appcreate_menucui_create
 * DESCRIPTION
 *  Create a app create menu cui for menu under phone setting. The group will 
 *  be closed if the input group id already exist. parent id, new group id, 
 *  menu cui id will be saved in user data.
 *
 *  Remember to free the memory in proc function
 *
 * PARAMETERS
 *  group_id    [IN]    new group id to be created
 *  proc        [IN]    proc function assigned to the new group
 *  menu_id     [IN]    menu id the menu cui assigned to
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_appcreate_menucui_create(MMI_ID parent_gid, MMI_ID group_id, U16 menu_id, mmi_proc_func proc)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    
    if(mmi_phnset_entry_group_check_ex(parent_gid,group_id))
        return;
	mmi_frm_group_create_ex(
		parent_gid,
        group_id,
        proc,
        NULL,
		MMI_FRM_NODE_SMART_CLOSE_FLAG);
	cui_menu_create_and_run(
		group_id,
        CUI_MENU_SRC_TYPE_APPCREATE,
        CUI_MENU_TYPE_APPMAIN,
        menu_id,
        MMI_FALSE,
        NULL);   
    
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_init_radio_button_menu
 * DESCRIPTION
 *  Initialize the radio button menu list for menu under phone setting 
 * PARAMETERS
 *  
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_phnset_init_radio_button_menu(phnset_radio_button_menu_data_struct *menu_data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 nNumofItem = menu_data->menu_item_num; 
    U8 i;
    U8 highlight_item = menu_data->highlighted_item_idx;
    mmi_menu_id *menu_id;
    MMI_ID menu_cui_id = mmi_frm_group_get_active_id();
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Dynamically create a menu id list */
    menu_id = (mmi_menu_id*)OslMalloc(nNumofItem * sizeof(mmi_menu_id));
    for(i = 0; i < nNumofItem; i++)
    {
        menu_id[i]=(mmi_menu_id)i;
    }
    
    cui_menu_set_currlist_title_by_id(menu_cui_id, menu_data->menu_title_str_id, menu_data->menu_icon_id);
    
    cui_menu_set_currlist(menu_cui_id, nNumofItem, menu_id);
    
    cui_menu_set_currlist_flags(menu_cui_id, CUI_MENU_NORMAL_RADIO_BUTTON_LIST);

    if (!mmi_frm_is_in_backward_scenario())
	{
            cui_menu_set_currlist_highlighted_id(menu_cui_id, highlight_item);
	}
        
    if (menu_data->menu_item_str_list)
	{
        for(i = 0; i < nNumofItem; i++)
        {
            cui_menu_set_item_string(menu_cui_id, menu_id[i], (WCHAR*)menu_data->menu_item_str_list[i]);
        }
        if (menu_data->menu_item_str_id_list)
    	{
    	    ASSERT(0);
    	}
	}
    else if (menu_data->menu_item_str_id_list)
	{
        for(i = 0; i < nNumofItem; i++)
        {
            cui_menu_set_item_string_by_id(menu_cui_id, menu_id[i], menu_data->menu_item_str_id_list[i]);
        }	    
	}
    else if(menu_data->menu_item_str_cb)
    {
        for(i = 0; i < nNumofItem; i++)
        {
            const S32 reqLen = menu_data->menu_item_str_cb(i, NULL, 0);
            WCHAR *name_buf = (WCHAR*)OslMalloc(reqLen * sizeof(WCHAR));
            if(name_buf)
            {
                menu_data->menu_item_str_cb(i, name_buf, reqLen);
                cui_menu_set_item_string(menu_cui_id, menu_id[i], name_buf);
                OslMfree(name_buf);
                name_buf = NULL;
            }            
        }
    }
    else
    {
        ASSERT(0);
    }

    /* Free the menu id list */
    OslMfree(menu_id);    
    
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_init_on_off_radio_button_menu
 * DESCRIPTION
 *  Init a radio button menu only contains on & off selection 
 * PARAMETERS
 *  void
 * RETURNS
 *  static void
 *****************************************************************************/
void mmi_phnset_init_on_off_radio_button_menu(MMI_ID group_id, U16 title_id, U16 icon_id, U8 highlight_item)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 on_off_strid_p[2] = {STR_GLOBAL_OFF, STR_GLOBAL_ON};
    phnset_radio_button_menu_data_struct on_off_menu_data;
        
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    on_off_menu_data.group_id = group_id;
    on_off_menu_data.menu_title_str_id = title_id;
    on_off_menu_data.menu_icon_id = icon_id;
    on_off_menu_data.menu_item_num = 2;
    on_off_menu_data.menu_item_str_list = NULL;
    on_off_menu_data.menu_item_str_id_list = on_off_strid_p;
    on_off_menu_data.highlighted_item_idx = highlight_item;
    
    mmi_phnset_init_radio_button_menu(&on_off_menu_data);
}

